# Shell Integration

clai integrates with your shell to provide command suggestions and history pickers.
It uses a thin client (`clai-shim`) for session logging and a history daemon
(`claid`) when available.

## Supported Shells

| Shell | Version | Status |
| ----- | ------- | ------ |
| zsh | 5.8+ | Full support |
| bash | 4.4+ (3.2 on macOS) | Full support |
| fish | 3.0+ | Full support |
| PowerShell | 7.x | Planned |

## How It Works

- **Suggestions** are provided by `clai suggest`.
- **History pickers** use `clai history` (SQLite) when the daemon is available.
- **Session logging** is done by `clai-shim`; it spawns `claid` if present.
- If `claid` is missing, suggestions fall back to your shell history file.

```text
Shell → clai suggest  (history + optional daemon)
     ↘ clai-shim → claid (session logging, optional)
```

## Installation

### Automatic (recommended)

```bash
clai install
```

This writes hooks to `~/.clai/hooks/` and adds a source line to your rc file.

### Manual (eval in rc)

```bash
eval "$(clai init zsh)"
# or
clai init fish | source
```

`clai init` generates a session ID each time it’s evaluated.

Session‑aware history requires a valid `CLAI_SESSION_ID` (generated by `clai init`
or set manually). If it’s missing, history is treated as global.

## Features

### Zsh

- Inline ghost‑text suggestions
- **Tab**: suggestion picker
- **Up Arrow**: history picker
- **Right Arrow**: accept suggestion
- **Alt+Right**: accept next token

### Bash

- **Tab**: menu completion with clai suggestions first
- **Up Arrow**: history picker

### Fish

- **Alt+Enter**: accept suggestion
- **Tab**: native completions + picker behavior
- **Up Arrow**: history picker

## Toggles

```bash
clai off           # disable globally (config)
clai on
clai off --session # disable for this shell only
```

You can also set `CLAI_OFF=1` to disable suggestions.

## Environment Variables

Set these **before** sourcing the hook:

```bash
# Max items shown in pickers
export CLAI_MENU_LIMIT=5

# Cache directory (suggestion/last_output)
export CLAI_CACHE="$HOME/.cache/clai"
```

## Notes on Experimental Hooks

The shell scripts include placeholders for:

- `run` wrapper (output extraction + diagnosis)
- `?` prefix for natural language

These require commands that are not currently shipped in the CLI.
Use `clai cmd` directly instead.

## Uninstalling

```bash
clai uninstall
```

## Next Steps

- [Configuration](configuration.md)
- [Troubleshooting](troubleshooting.md)
