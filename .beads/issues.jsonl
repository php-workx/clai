{"id":"ai-terminal-0cx","title":"clai Phase 1 Implementation","description":"Implement the complete clai Phase 1 architecture as specified in tech_design.md:\n- Shell Integration (zsh, bash, PowerShell hooks)\n- Thin Client Binary (clai-shim) for fire-and-forget shell communication\n- User-mode Daemon (clai-daemon) as central brain\n- SQLite storage with WAL mode\n- Provider adapters for AI (Anthropic, OpenAI, Google)\n- Suggestion ranking engine\n- gRPC/Protobuf IPC layer\n\nThis follows the 7-stream parallel implementation plan from the tech spec (Sections 15-18).","status":"closed","priority":1,"issue_type":"epic","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:57:07.759409+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T06:05:25.422847+01:00","closed_at":"2026-01-30T06:05:25.422847+01:00","close_reason":"All 7 implementation streams completed. Full Phase 1 architecture implemented: gRPC/Protobuf IPC, SQLite storage, clai-shim, clai-daemon, CLI commands, shell hooks (zsh/bash), provider adapters (Anthropic/OpenAI/Google), ranking engine, and integration tests (26 passing). Ready for documentation and deployment."}
{"id":"ai-terminal-0cx.1","title":"Stream A: Proto \u0026 gRPC Foundation","description":"**Wave 1 - No Dependencies**\n\nDeliverables:\n- proto/clai/v1/clai.proto (messages and ClaiService from tech_design.md Section 4)\n- gen/proto/clai/v1/*.pb.go (generated)\n- Makefile with proto target\n\nKey Messages: ClientInfo, Ack, SessionStartRequest, SessionEndRequest, CommandStartRequest, CommandEndRequest, SuggestRequest/Response, TextToCommandRequest/Response, NextStepRequest/Response, DiagnoseRequest/Response, StatusResponse\n\nService Methods:\n- Fire-and-Forget: SessionStart, SessionEnd, CommandStarted, CommandEnded\n- Interactive: Suggest, TextToCommand, NextStep, Diagnose\n- Ops: Ping, GetStatus\n\nAcceptance Criteria:\n- make proto generates Go code without errors\n- Generated code compiles\n- Basic gRPC server/client can exchange Ping message\n- All serialization tests pass","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:00.338687+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T18:53:47.337951+01:00","closed_at":"2026-01-29T18:53:47.337951+01:00","close_reason":"Implemented proto/gRPC foundation with all messages and service methods. Tests pass.","dependencies":[{"issue_id":"ai-terminal-0cx.1","depends_on_id":"ai-terminal-0cx","type":"parent-child","created_at":"2026-01-29T17:58:00.339766+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-0cx.2","title":"Stream B: Storage Layer (SQLite)","description":"**Wave 1 - No Dependencies**\n\nDeliverables:\n- internal/storage/db.go - Connection, migrations\n- internal/storage/sessions.go - Session CRUD\n- internal/storage/commands.go - Command CRUD\n- internal/storage/cache.go - AI cache operations\n- internal/storage/queries.go - Raw SQL queries\n\nTables: sessions, commands, ai_cache, schema_meta\nFeatures: WAL mode, schema versioning, concurrent access\n\nAcceptance Criteria:\n- Implements Store interface (Section 15.3)\n- Creates schema on first run\n- All CRUD operations work\n- 90% test coverage\n- WAL mode enabled","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:00.557611+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T19:09:55.996541+01:00","closed_at":"2026-01-29T19:09:55.996541+01:00","close_reason":"Implementation complete: all files created, tests passing, lint clean","dependencies":[{"issue_id":"ai-terminal-0cx.2","depends_on_id":"ai-terminal-0cx","type":"parent-child","created_at":"2026-01-29T17:58:00.55845+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-0cx.3","title":"Stream F: Provider Adapters (AI)","description":"**Wave 1 - No Dependencies**\n\nDeliverables:\n- internal/provider/provider.go - Interface\n- internal/provider/registry.go - Provider selection\n- internal/provider/anthropic.go - Claude CLI/API\n- internal/provider/openai.go - OpenAI CLI/API\n- internal/provider/google.go - Gemini CLI/API\n- internal/provider/context.go - AI context builder\n- internal/sanitize/sanitizer.go - Regex sanitization\n- internal/sanitize/patterns.go - Secret patterns\n- internal/sanitize/risk.go - Destructive detection\n\nFeatures:\n- CLI-first (wrap claude, openai, gemini CLIs)\n- Fallback to direct API\n- Sanitization for AWS keys, JWT, Slack tokens, PEM, passwords\n- Risk tagging for rm -rf, DROP TABLE, --force, etc.\n\nAcceptance Criteria:\n- Implements Provider interface\n- CLI detection with API fallback\n- Sanitizes input before AI calls\n- 10-second timeout for AI calls\n- 80% test coverage","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:00.791476+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T19:09:55.999639+01:00","closed_at":"2026-01-29T19:09:55.999639+01:00","close_reason":"Implementation complete: all files created, tests passing, lint clean","dependencies":[{"issue_id":"ai-terminal-0cx.3","depends_on_id":"ai-terminal-0cx","type":"parent-child","created_at":"2026-01-29T17:58:00.792277+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-0jl","title":"docs/shell-integration.md: align supported shells","description":"In docs/shell-integration.md around line 5-12: This page lists zsh/bash only, while other docs mention fish. Confirm actual support and align the supported-shells list to avoid user confusion.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.049406+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.044949+01:00","closed_at":"2026-01-30T08:52:35.044949+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-0jl","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:22.846824+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-0zs","title":"Shell UX Enhancements","description":"Advanced shell integration features for improved command completion and history navigation. These are higher complexity features that require deep shell integration.","status":"closed","priority":3,"issue_type":"epic","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:08:30.256491+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:42:28.726601+01:00","closed_at":"2026-02-03T06:42:28.726601+01:00","close_reason":"Closed"}
{"id":"ai-terminal-1jv","title":"db_test.go: avoid filepath.Join for non-path string","description":"In internal/storage/db_test.go around line 216-218: filepath.Join uses OS-specific path separators, which could cause test failures or inconsistent IDs across platforms. Use fmt.Sprintf instead for predictable ID generation.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:49.41678+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.721111+01:00","closed_at":"2026-01-30T08:53:47.721111+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-1jv","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:52.084214+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-1lo","title":"dial_test.go: align test expectations with production fallback","description":"In internal/ipc/dial_test.go around line 9-17 and 32-38: SocketPath()/RunDir() fall back to '/tmp' on os.UserHomeDir() errors. The tests currently would build an empty expected path in that case. Handle the fallback to '/tmp' in test expectations.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:37.353294+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.689044+01:00","closed_at":"2026-01-30T08:57:29.689044+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-1lo","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:40.148652+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-1o0","title":"handlers.go: fix truncate panic on zero/negative maxLen","description":"In internal/daemon/handlers.go around line 457-466: truncate panics if maxLen is 0 or negative. Add a guard at the start to return empty string if maxLen \u003c= 0.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:47.003315+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:40.487284+01:00","closed_at":"2026-01-30T08:53:40.487284+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-1o0","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:50.895454+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-1q6","title":"db_test.go: fix concurrent write test error handling","description":"In internal/storage/db_test.go around line 115-179: The error channel has capacity for numWriters*writesPerWriter errors, but the collection loop only reads numWriters times. If a goroutine encounters an error mid-loop, it sends the error and returns early, but subsequent goroutines may still complete. Consider making this clearer or handling all potential error values.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:10.800403+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.697596+01:00","closed_at":"2026-01-30T08:53:47.697596+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-1q6","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:20.314877+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-1uq","title":"Documentation \u0026 README Updates","description":"**Wave 5 - After Integration**\n\nSections:\n- Installation (macOS, Linux, Windows)\n- Quick Start\n- Shell Integration (zsh, bash, PowerShell)\n- Configuration Options\n- AI Provider Setup\n- Troubleshooting / FAQ\n\nAcceptance Criteria:\n- README covers all platforms\n- Shell integration documented\n- Config options documented\n- AI provider setup guide","notes":"User is handling README.md separately. Technical documentation will go in docs/ folder instead.","status":"closed","priority":3,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:40.383703+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T06:13:31.290494+01:00","closed_at":"2026-01-30T06:13:31.290494+01:00","close_reason":"Created 6 documentation files in docs/: installation.md, quickstart.md, shell-integration.md, configuration.md, ai-providers.md, troubleshooting.md. Total ~1,200 lines covering all platforms, shell setup, config options, AI provider setup, and FAQ.","dependencies":[{"issue_id":"ai-terminal-1uq","depends_on_id":"ai-terminal-819","type":"blocks","created_at":"2026-01-29T17:59:36.796688+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-1x9","title":"go.mod: review grpc v1.78.0 breaking change","description":"In go.mod around line 3-11: google.golang.org/grpc v1.78.0 introduces breaking behavior changes including client URL validation that rejects unbracketed colons in hostnames. Ensure CI/dev environments test against these versions and verify no existing client URLs break under the new grpc validation rules. Also modernc.org/sqlite v1.44.3 was very recently released.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:40.523811+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.200517+01:00","closed_at":"2026-01-30T08:52:35.200517+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-1x9","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:47.192762+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-1xo","title":"commands.go: change IsSuccess to pointer type for tri-state","description":"In internal/storage/commands.go around line 46-50: Change the Command.IsSuccess field to a pointer type (*bool) so it can be tri-state (nil = unknown), then in the CreateCommand logic treat nil as success: initialize isSuccess := 1 and only set isSuccess = 0 when cmd.IsSuccess != nil \u0026\u0026 !*cmd.IsSuccess. Update any call sites to pass a pointer when they explicitly know success/failure. This makes unset/unknown exit state default to success.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:29.756406+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.629732+01:00","closed_at":"2026-01-30T08:53:47.629732+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-1xo","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:36.095911+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-2gl","title":"commands.go: deduplicate NormalizeCommand/HashCommand/isNumeric","description":"The functions NormalizeCommand, HashCommand, and isNumeric are duplicated in internal/storage/commands.go and internal/suggest/normalize.go. To improve maintainability and avoid code duplication, these helper functions should be defined in a single location (e.g., the suggest package) and imported where needed. The storage package could then call suggest.Normalize() and suggest.Hash().","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:35:28.466041+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:43:20.478617+01:00","closed_at":"2026-01-30T08:43:20.478617+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-2gl","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:35:56.931962+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-2xo","title":"lifecycle.go: make WaitForSocketWithPaths respect context","description":"In internal/daemon/lifecycle.go around line 163-176: WaitForSocketWithPaths doesn't respect context cancellation. The function only checks the deadline but doesn't allow early cancellation via context. Refactor to support context.WithTimeout and select on ctx.Done().","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:19.649406+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:40.49656+01:00","closed_at":"2026-01-30T08:53:40.49656+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-2xo","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:25.932301+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-31i","title":"clai.zsh: add prefix-match check for suggestion suffix","description":"In hooks/clai.zsh around line 114-136: When the suggestion doesn't start with the buffer content, the suffix display shows misleading ghost text. Add a check that the suggestion actually begins with the current buffer before displaying the suffix.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:40.29078+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.17747+01:00","closed_at":"2026-01-30T08:52:35.17747+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-31i","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:46.945591+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-31o","title":"docs/ai-providers.md: pad table separator rows","description":"In docs/ai-providers.md around line 7-12 and 188-193: Table separator rows need padding to satisfy markdownlint MD060.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.225877+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:34.925469+01:00","closed_at":"2026-01-30T08:52:34.925469+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-31o","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.383135+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-3fa","title":"handlers.go: remove unused info variable","description":"In internal/daemon/handlers.go around line 185-191: The info variable is fetched from the session manager but immediately discarded with '_ = info'. The comment suggests this could query the last command from DB. Either implement the intended functionality or remove the dead code.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:43.164072+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:40.490271+01:00","closed_at":"2026-01-30T08:53:40.490271+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-3fa","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:46.756863+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-3xh","title":"Command suggestion while typing (history matching)","description":"Show command suggestions as user types, matching against command history.\n\n**Inspiration:** Fish shell's autosuggestions, zsh-autosuggestions plugin\n\n**Technical approach:**\n1. ZLE widget hooked to every keystroke (zle -N self-insert)\n2. Parse shell history file (~/.zsh_history, ~/.bash_history)\n3. Fuzzy match current BUFFER against history\n4. Display suggestion in dim text after cursor (POSTDISPLAY in Zsh)\n5. Tab or right-arrow to accept\n\n**Complexity:** High - requires efficient history indexing, per-keystroke performance\n\n**Files:**\n- internal/cmd/shell/zsh/clai.zsh - ZLE hooks\n- internal/cmd/shell/bash/clai.bash - readline integration\n- internal/cmd/shell/fish/clai.fish - Fish already has this, may just enable\n\n**Research needed:**\n- Performance impact of history search on every keystroke\n- How zsh-autosuggestions handles large history files\n- Whether to cache/index history","status":"closed","priority":3,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:08:42.400012+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T17:54:07.22547+01:00","closed_at":"2026-01-29T17:54:07.22547+01:00","close_reason":"Implemented inline history suggestions using POSTDISPLAY. Right-arrow to accept.","dependencies":[{"issue_id":"ai-terminal-3xh","depends_on_id":"ai-terminal-0zs","type":"parent-child","created_at":"2026-01-28T19:09:13.095286+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-4gx","title":"Add 'Run X to Y' extraction pattern","description":"Commands like 'Run bd doctor --fix to see details' aren't extracted because Pattern 3 requires a colon (Run: X).\n\n**Solution:** Add new pattern to match 'Run \u003ccommand\u003e to \u003caction\u003e' format.\n\n**Files:**\n- internal/extract/extract.go - Add pattern\n- internal/extract/extract_test.go - Add test cases\n\n**Acceptance:** 'Run bd doctor --fix to see details' extracts 'bd doctor --fix'","notes":"On hold per user request","status":"closed","priority":4,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:05:04.161921+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:38:43.501549+01:00","closed_at":"2026-02-03T06:38:43.501549+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-4gx","depends_on_id":"ai-terminal-b0k","type":"parent-child","created_at":"2026-01-28T19:05:48.170198+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-4mb","title":"status.go: deduplicate config.DefaultPaths() call","description":"In internal/cmd/status.go around line 100-127: checkShellIntegration creates its own config.DefaultPaths() instance while runStatus already has one at line 34. Refactor checkShellIntegration to accept paths as a parameter to avoid the redundant call.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.623163+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.445419+01:00","closed_at":"2026-01-30T08:52:37.445419+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-4mb","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.596717+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-54k","title":"normalize.go: align DeduplicateKey comment with behavior","description":"In internal/suggest/normalize.go around line 63-68: The comment says it uses a storage hash, but the function returns the input verbatim. Either update the comment or wire this to Hash to avoid confusion.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:40.046125+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.691831+01:00","closed_at":"2026-01-30T08:57:29.691831+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-54k","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:46.706516+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-54y","title":"docs/quickstart.md: pad table separator row","description":"In docs/quickstart.md around line 122-127: The table separator row needs padding to satisfy markdownlint MD060.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:15.36579+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:34.900496+01:00","closed_at":"2026-01-30T08:52:34.900496+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-54y","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:22.246019+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-5em","title":"clai-picker TUI (History Picker)","description":"Build standalone clai-picker binary with Bubble Tea TUI for cross-shell history selection. Spec: specs/2026-02-04-clai-picker-tui.md. Plan: .agents/plans/2026-02-04-clai-picker-tui.md.","status":"open","priority":2,"issue_type":"epic","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:04:53.719978+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:04:53.719978+01:00","labels":["planned"]}
{"id":"ai-terminal-5em.1","title":"Add dependencies and picker config","description":"**Wave 1** (no dependencies)\n\nAdd bubbletea v2 and lipgloss v1 to go.mod. Add HistoryConfig struct to internal/config/config.go with picker keys:\n- picker_backend (builtin|fzf|clai)\n- picker_open_on_empty (bool)\n- picker_page_size (int, 20-500, default 100)\n- picker_case_sensitive (bool)\n- picker_tabs (list of TabDef: id, label, provider, args)\n\nWire into config load/save/list cycle. Unit tests for config validation.\n\nAcceptance:\n- go get bubbletea/lipgloss succeeds\n- HistoryConfig struct added with YAML tags\n- go build ./cmd/clai-picker compiles\n- Config keys in ListKeys()\n- make dev passes","status":"open","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:05:01.072151+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:05:01.072151+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-5em.1","depends_on_id":"ai-terminal-5em","type":"parent-child","created_at":"2026-02-04T12:05:01.073467+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-5em.2","title":"Add FetchHistory gRPC RPC","description":"**Wave 1** (no dependencies)\n\nAdd FetchHistory RPC to proto/clai/v1/clai.proto:\n- HistoryFetchRequest: session_id, query, limit, offset, global\n- HistoryFetchResponse: items (repeated HistoryItem), at_end\n- HistoryItem: command, timestamp_ms\n\nImplement daemon handler: query SQLite with session/global scope, substring filter, pagination, deduplication (by command text, keep most recent by ts_unix_ms). Strip ANSI escape sequences from entries.\n\nAdd storage query method if needed for substring + session scoping.\n\nAcceptance:\n- protoc generates Go code successfully\n- Daemon handler returns correct paginated, filtered, deduplicated results\n- Unit test passes\n- make dev passes","status":"open","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:05:07.093494+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:05:07.093494+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-5em.2","depends_on_id":"ai-terminal-5em","type":"parent-child","created_at":"2026-02-04T12:05:07.106117+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-5em.3","title":"CLI entry point + dispatch skeleton","description":"**Wave 2** (depends on: Issue 1 - config)\n\nImplement cmd/clai-picker/main.go with startup order:\n1. Check /dev/tty openable (exit 2)\n2. Check TERM != dumb (exit 2)\n3. Check terminal width \u003e= 20 (exit 2)\n4. Acquire file lock $CLAI_CACHE/picker.lock (exit 1)\n5. Parse flags (exit 1 with usage on error)\n6. Read config, choose backend\n7. Dispatch to backend\n\nFlags: --tabs, --limit, --query (max 4096, sanitize), --session, --output=plain\nSupport --help, --version. Unknown flags → exit 1.\nInput sanitization: strip control chars from query, reject newlines.\nBackend dispatch: builtin | fzf | clai. Fallback: fzf→builtin silently.\n\nAcceptance:\n- clai-picker history runs with proper startup order\n- Exit codes correct (0/1/2)\n- File lock prevents concurrent instances\n- make dev passes","status":"open","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:05:15.110588+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:05:15.110588+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-5em.3","depends_on_id":"ai-terminal-5em","type":"parent-child","created_at":"2026-02-04T12:05:15.112152+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-5kk","title":"db.go: propagate schema version read errors","description":"In internal/storage/db.go around line 92-101: The code reading the current schema version using s.db.QueryRowContext -\u003e row.Scan currently treats any non-ErrNoRows error as harmless and resets currentVersion to 0. Instead, when row.Scan returns an error that is neither sql.ErrNoRows nor recognized by isTableNotFoundError, return that error to the caller (propagate or wrap it) so we don't silently run migrations on a broken DB.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.555172+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.674739+01:00","closed_at":"2026-01-30T08:53:47.674739+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-5kk","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.591627+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-5x2","title":"client.go: accept context.Context in Suggest","description":"In internal/ipc/client.go around line 126-153: While Suggest has a short timeout (50ms), accepting a context parameter would allow callers to cancel early if needed and maintains API consistency with other interactive methods.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:21.159423+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.675834+01:00","closed_at":"2026-01-30T08:57:29.675834+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-5x2","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:27.774089+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-69m","title":"Add model selection support (Haiku/Sonnet)","description":"All queries use Claude CLI default model. Want Haiku for fast voice commands, Sonnet for complex diagnosis.\n\n**Solution:**\n1. Add CLAI_MODEL_VOICE and CLAI_MODEL_DIAGNOSE env vars\n2. Pass --model flag to Claude CLI when set\n3. Default: Haiku for voice, Sonnet for diagnose\n\n**Files:**\n- internal/claude/claude.go - Add model parameter to Query functions\n- internal/claude/daemon.go - Model in daemon requests\n- internal/cmd/voice.go - Use voice model\n- internal/cmd/diagnose.go - Use diagnose model\n\n**Acceptance:** CLAI_MODEL_VOICE=haiku uses Haiku for voice commands.","notes":"Implemented: Daemon uses Haiku model. Benchmarked Haiku vs Sonnet (1.28x faster). Model switching mid-session not possible in stream-json mode.","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:05:16.358896+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T17:37:06.471636+01:00","closed_at":"2026-01-29T17:37:06.471636+01:00","close_reason":"Implemented: Daemon uses Haiku model for fast voice commands. Benchmarked 1.28x faster than Sonnet with equivalent quality.","dependencies":[{"issue_id":"ai-terminal-69m","depends_on_id":"ai-terminal-b0k","type":"parent-child","created_at":"2026-01-28T19:05:48.353461+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-819","title":"Integration Testing \u0026 Checkpoints","description":"**Wave 5 - Depends on all streams**\n\nIntegration Checkpoints:\n- CP1: Basic IPC - Ping works between shim and daemon\n- CP2: Session Flow - Session start/end persists to SQLite\n- CP3: Command Logging - Commands logged with exit codes\n- CP4: Suggestions - History-based suggestions work\n- CP5: AI Integration - Text-to-command with AI provider\n- CP6: Full CLI - All clai commands work end-to-end\n\nDeliverables:\n- tests/integration/e2e_test.go\n- tests/integration/session_test.go\n- tests/integration/suggest_test.go\n- tests/integration/shell_hooks_test.go\n\nShell Compatibility: zsh 5.8+, bash 4.4+/3.2, PowerShell 7.x\n\nAcceptance Criteria:\n- All 6 checkpoints pass\n- E2E tests for session lifecycle\n- E2E tests for suggestions flow\n- CI/CD pipeline runs integration tests","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:40.186675+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T06:02:41.031876+01:00","closed_at":"2026-01-30T06:02:41.031876+01:00","close_reason":"All 6 integration checkpoints implemented and passing. Created e2e_test.go, session_test.go, suggest_test.go, and testutil.go. All tests pass, lint clean.","dependencies":[{"issue_id":"ai-terminal-819","depends_on_id":"ai-terminal-pex","type":"blocks","created_at":"2026-01-29T17:59:36.420901+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-819","depends_on_id":"ai-terminal-8pq","type":"blocks","created_at":"2026-01-29T17:59:36.512022+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-819","depends_on_id":"ai-terminal-uhl","type":"blocks","created_at":"2026-01-29T17:59:36.610578+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-819","depends_on_id":"ai-terminal-0cx.3","type":"blocks","created_at":"2026-01-29T17:59:36.706896+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-8cc","title":"openai.go: preallocate suggestions slice","description":"In internal/provider/openai.go around line 188-191: The suggestions slice can be preallocated since only up to 3 suggestions are returned. Change 'var suggestions []Suggestion' to 'suggestions := make([]Suggestion, 0, 3)'.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.641838+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.140174+01:00","closed_at":"2026-01-30T08:52:32.140174+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-8cc","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.804724+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-8pq","title":"Stream D: clai-daemon (Core Server)","description":"**Wave 3 - Depends on Streams A, B, G**\n\nDeliverables:\n- cmd/clai-daemon/main.go (or integrated into cmd/clai/)\n- internal/daemon/server.go - gRPC server setup\n- internal/daemon/lifecycle.go - Start, stop, idle timeout\n- internal/daemon/session_manager.go - Session tracking\n- internal/daemon/handlers/*.go - All RPC handlers\n\nIPC: Unix socket ~/.clai/run/clai.sock (Windows: named pipe)\nLifecycle: Auto-exit after 20min idle, graceful SIGTERM shutdown\n\nAcceptance Criteria:\n- Listens on Unix socket\n- Writes PID file\n- Handles all gRPC methods\n- Auto-shutdown after idle timeout\n- Cleans up on exit\n- Concurrent session support\n- 80% test coverage","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:39.762255+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T05:37:16.20402+01:00","closed_at":"2026-01-30T05:37:16.20402+01:00","close_reason":"Implementation complete: daemon server, handlers, session manager, lifecycle management. All tests passing.","dependencies":[{"issue_id":"ai-terminal-8pq","depends_on_id":"ai-terminal-0cx.1","type":"blocks","created_at":"2026-01-29T17:59:35.977582+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-8pq","depends_on_id":"ai-terminal-0cx.2","type":"blocks","created_at":"2026-01-29T17:59:36.067477+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-8pq","depends_on_id":"ai-terminal-h8y","type":"blocks","created_at":"2026-01-29T17:59:36.15713+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-8tt","title":"doctor.go: add explicit warnings for missing API keys","description":"In internal/cmd/doctor.go around line 244-294: OpenAI/Google providers disappear from the report when their keys are unset, which can read as 'all good'. Add warn results for missing keys to make the output comprehensive.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:55.157371+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.328401+01:00","closed_at":"2026-01-30T08:52:37.328401+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-8tt","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:57.615981+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-94o","title":"doctor.go: make checks side-effect free","description":"In internal/cmd/doctor.go around line 125-172: The doctor command creates missing directories which is a surprising side effect for a diagnostic. Consider gating creation behind a flag (e.g., --fix) or reporting 'would create' instead.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:27.986722+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.353236+01:00","closed_at":"2026-01-30T08:52:37.353236+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-94o","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:32.448779+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-98w","title":"openai.go: handle numbered/bulleted lines in fix-detection","description":"In internal/provider/openai.go around line 268-282: The code currently only starts collecting fixes when inFixes is true and ignores lines like '1. cmd' or '- cmd'. Update the fix-detection logic so that numbered or bulleted lines also open the fixes section: detect patterns such as /^\\s*\\d+\\.\\s+/, /^\\s*\\d+\\)\\s+/, or /^\\s*[-*]\\s+/ and treat them as valid cleaned commands (set inFixes = true and normalize the cleaned text) before applying the existing sanitize.IsDestructive check and appending a Suggestion to fixes.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:28.974116+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.134438+01:00","closed_at":"2026-01-30T08:52:32.134438+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-98w","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:35.394345+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-9fr","title":"Fix Tab suggestion cleared prematurely","description":"clai extract overwrites suggestion file even when no pattern matches, clearing previous AI suggestions.\n\n**Solution:** Only write to suggestion cache if a non-empty suggestion was found. Preserve existing suggestion otherwise.\n\n**Files:**\n- internal/cmd/extract.go - Conditional cache write\n\n**Acceptance:** Previous suggestion persists when new command has no extractable suggestion.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:05:10.183394+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:42:54.854072+01:00","closed_at":"2026-02-03T06:42:54.854072+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-9fr","depends_on_id":"ai-terminal-b0k","type":"parent-child","created_at":"2026-01-28T19:05:48.260835+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-9fr","depends_on_id":"ai-terminal-4gx","type":"blocks","created_at":"2026-01-28T19:05:54.478033+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-9gz","title":"Fix Escape key not stopping AI analysis","description":"Two-part fix for interrupting AI analysis:\n\n**Part 1: Documentation (quick win)**\nDocument that Ctrl+C interrupts AI analysis. Update README and shell script comments.\n\n**Part 2: Implement ESC interrupt (investigate)**\nResearch and implement ESC key to interrupt running clai processes and return to terminal.\n\n**Technical context:**\n- Ctrl+C already works (Go context.Context cancellation)\n- ESC is intercepted by shell (ZLE in Zsh) before reaching clai process\n- Shell can't easily send SIGINT to backgrounded subprocess\n\n**Research needed for Part 2:**\n- Can ZLE widget send signal to specific PID?\n- Store clai PID in temp file, ESC handler reads and kills?\n- Or: clai polls a cancel file while waiting for Claude response?\n\n**Files:**\n- README.md - Document Ctrl+C\n- internal/cmd/shell/zsh/clai.zsh - ESC binding + PID tracking\n- internal/cmd/shell/bash/clai.bash - trap + PID tracking\n- internal/cmd/shell/fish/clai.fish - bind escape + PID tracking\n- Possibly: internal/claude/claude.go - poll cancel file\n\n**Acceptance:** \n- README documents Ctrl+C for interruption\n- ESC key stops running analysis and returns to prompt (if feasible)","notes":"On hold per user request","status":"closed","priority":4,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:05:22.896834+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:38:43.498869+01:00","closed_at":"2026-02-03T06:38:43.498869+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-9gz","depends_on_id":"ai-terminal-b0k","type":"parent-child","created_at":"2026-01-28T19:05:48.445601+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-9hs","title":"client.go: accept context in TextToCommand","description":"In internal/ipc/client.go around line 155-173: TextToCommand currently creates a background context, preventing caller cancelation. Change the method signature on Client from TextToCommand(sessionID, prompt, cwd string, maxSuggestions int) to TextToCommand(ctx context.Context, sessionID, prompt, cwd string, maxSuggestions int) and replace context.WithTimeout(context.Background(), InteractiveTimeout) with context.WithTimeout(ctx, InteractiveTimeout). Update callers of TextToCommand accordingly so they pass their incoming context for Ctrl+C interruptibility.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:24.071447+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.67279+01:00","closed_at":"2026-01-30T08:57:29.67279+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-9hs","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:26.705892+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-9sw","title":"spawn.go: add build-tagged helper for process group setup","description":"In internal/ipc/spawn.go around line 72-75: The Unix-only use of syscall.SysProcAttr.Setpgid breaks Windows builds. Create a build-tagged helper function setProcessGroup(cmd *exec.Cmd) with two files: one //go:build !windows that sets cmd.SysProcAttr = \u0026syscall.SysProcAttr{Setpgid: true}, and one //go:build windows that is a no-op, then replace the direct assignment in spawn.go (and the analogous code in daemon.go) with a call to the setProcessGroup function so process-group setup is isolated per OS.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:30.838714+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.678285+01:00","closed_at":"2026-01-30T08:57:29.678285+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-9sw","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:33.490022+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-9xb","title":"spawn_test.go: isolate runtime dir in SpawnDaemon test","description":"In internal/ipc/spawn_test.go around line 84-102: SpawnDaemon() creates the run dir before it fails on missing binary, so this test can create directories under the real user home. Point the runtime dir to the temp directory using XDG_RUNTIME_DIR environment variable.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.955088+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.686043+01:00","closed_at":"2026-01-30T08:57:29.686043+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-9xb","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.854346+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-ais","title":"docs/README_v0.md: fix markdownlint warnings","description":"In docs/README_v0.md around line 153-162, 197-205, 229-250, 254-274: Fix markdownlint table (MD060) and code-fence (MD040) warnings. Add spaces in tables and specify languages for fenced blocks.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.331445+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.066413+01:00","closed_at":"2026-01-30T08:52:35.066413+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-ais","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.352352+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-al5","title":"sources.go: continue on partial failures in QueryAllScopes","description":"In internal/suggest/sources.go around line 114-147: Currently, if any scope query fails, the entire operation returns an error. For a suggestion system, partial results are often preferable to no results. Consider continuing on partial failures so the caller could still receive session and CWD suggestions even if the global query fails.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:19.167873+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.697521+01:00","closed_at":"2026-01-30T08:57:29.697521+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-al5","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:25.479554+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-b0k","title":"CLAI Improvements","description":"Bug fixes and model selection feature for clai. Covers extraction patterns, suggestion caching, model selection, and diagnosis improvements.","notes":"CRANK_COMPLETE: all children closed at 2026-02-03T15:22:15+01:00","status":"closed","priority":1,"issue_type":"epic","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:04:26.732732+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T15:22:15.643023+01:00","closed_at":"2026-02-03T15:22:15.643027+01:00"}
{"id":"ai-terminal-b1g","title":"Prevent repetitive error suggestions","description":"Error analysis suggests the same fix repeatedly (e.g., always says 'install requests' even after user tried).\n\n**Solution:**\n1. Cache last N diagnosis results with command hash\n2. Include previous suggestions in prompt context\n3. Add 'I already tried X' awareness\n\n**Files:**\n- internal/cmd/diagnose.go - History-aware prompting\n- internal/cache/cache.go - Add diagnosis history cache\n\n**Acceptance:** Re-running diagnosis for same error provides alternative suggestions.","status":"closed","priority":3,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:05:28.962972+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:38:43.504312+01:00","closed_at":"2026-02-03T06:38:43.504312+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-b1g","depends_on_id":"ai-terminal-b0k","type":"parent-child","created_at":"2026-01-28T19:05:48.535181+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-bup","title":"google.go: pre-allocate suggestions and fix negative score","description":"In internal/provider/google.go around line 205-251: Pre-allocate the suggestions slice (max 3 items). Additionally, the score calculation could produce negative scores if logic changes. Consider clamping with max(0.1, 1.0-float64(len(suggestions))*0.1).","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:51.123116+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.131458+01:00","closed_at":"2026-01-30T08:52:32.131458+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-bup","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:54.262607+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-bz5","title":"Makefile: improve protoc error message for cross-platform","description":"The error message for protoc not being found suggests using brew, which is specific to macOS. This could be confusing for users on other operating systems. A more general message pointing to the official installation instructions would be more helpful for cross-platform compatibility. Change to: echo \"Error: protoc not found. Please install the protobuf compiler. See: https://grpc.io/docs/protoc-installation/\"","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:35:48.028299+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:40:59.949916+01:00","closed_at":"2026-01-30T08:40:59.949916+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-bz5","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:35:57.162277+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-c8h","title":"Per-tab command history","description":"Maintain separate command history per terminal tab/session, so arrow-up shows commands from current context.\n\n**Problem:** Global history mixes commands from different projects/contexts\n\n**Technical approach:**\n1. Detect terminal tab/session identifier:\n   - $TERM_SESSION_ID (iTerm2)\n   - $KITTY_WINDOW_ID (Kitty)\n   - $GHOSTTY_RESOURCES_DIR + PID (Ghostty)\n   - $TMUX_PANE (tmux)\n   - Fallback: TTY device (/dev/ttys001)\n2. Store history in per-session files: ~/.cache/clai/history/\u003csession-id\u003e\n3. Merge with global history on session end (optional)\n\n**Complexity:** Medium - mostly configuration and file management\n\n**Challenges:**\n- Different terminal emulators use different env vars\n- Session ID persistence across shell restarts\n- History file cleanup for old sessions\n\n**Files:**\n- internal/cmd/shell/zsh/clai.zsh - HISTFILE override\n- internal/cmd/shell/bash/clai.bash - HISTFILE override  \n- internal/cmd/shell/fish/clai.fish - fish_history variable\n- New: internal/cmd/history.go - Session detection logic","notes":"On hold per user request","status":"closed","priority":4,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:09:06.208707+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:38:43.489002+01:00","closed_at":"2026-02-03T06:38:43.489002+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-c8h","depends_on_id":"ai-terminal-0zs","type":"parent-child","created_at":"2026-01-28T19:09:13.275242+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-ch4","title":"bug(zsh): picker navigation broken - arrows, tab, escape don't work","description":"When the suggestion picker menu shows up after pressing Tab, navigation keys (arrows, tab, escape) don't work. Root causes: 1) bare \\\\e binding intercepts arrow key escape sequences when KEYTIMEOUT is low, 2) _clai_picker_up runs clai config on every keypress blocking ZLE, 3) only CSI-mode arrow sequences bound, not application-mode.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T18:29:50.564983+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T18:30:10.936432+01:00","closed_at":"2026-02-03T18:30:10.936432+01:00","close_reason":"Fixed in 25fa4fb: removed bare \\e binding, reordered picker_up to check active first, added application-mode arrow bindings, override send-break for Ctrl+C cancel"}
{"id":"ai-terminal-cox","title":"server.go: make Start() respect context cancellation","description":"In internal/daemon/server.go around line 128-184: The Start method currently blocks on s.grpcServer.Serve(listener) and ignores the passed ctx. Change it to launch Serve in a goroutine and then select on ctx.Done() versus Serve completion so cancellation triggers a clean shutdown: start Serve(listener) in a goroutine (capture any error via channel), in the main goroutine select on ctx.Done() to call s.grpcServer.GracefulStop() (or s.grpcServer.Stop() if forced) and close the listener, then wait for the Serve goroutine to finish and return either the Serve error or a context-cancellation error.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:15.506996+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:40.499525+01:00","closed_at":"2026-01-30T08:53:40.499525+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-cox","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:20.354003+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-cxx","title":"openai.go: make CLI detection resilient","description":"In internal/provider/openai.go around line 43-53: Line 145 checks only p.cliPath, which is set in Available(). If a caller skips Available() (or PATH changes), CLI-capable installs still hit the 'not available' error. Consider lazily resolving the CLI path inside query.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:21.803783+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.137342+01:00","closed_at":"2026-01-30T08:52:32.137342+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-cxx","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:28.289378+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-d75","title":"spawn_test.go: make temp daemon binary executable","description":"In internal/ipc/spawn_test.go around line 29-49: If findDaemonBinary() checks the execute bit, the temp file created may fail the lookup. Set the mode with os.Chmod to 0o755 to avoid platform-dependent test failure.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.22465+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.683556+01:00","closed_at":"2026-01-30T08:57:29.683556+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-d75","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.148203+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-d8v","title":"google.go: fix data race in Available() cliPath mutation","description":"In internal/provider/google.go around line 44-63: Available() mutates GoogleProvider.cliPath concurrently causing a data race. Fix by making initialization thread-safe: add a sync.Once field (e.g., cliOnce) or a mutex to the GoogleProvider struct and move the CLI discovery logic currently in Available() into a once.Do closure (or protected critical section) that sets cliPath (and an optional cached availability flag), then have Available() call cliOnce.Do(...) and read the cached values instead of writing cliPath on every call.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.66556+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.125755+01:00","closed_at":"2026-01-30T08:52:32.125755+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-d8v","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:35.156845+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-do1","title":"colors.go: add TTY check before enabling ANSI","description":"In internal/cmd/colors.go around line 20-41: The comment says colors are disabled when not a terminal, but there's no TTY detection. This can leak escape codes into pipes/logs. Check os.Stdout.Stat() for ModeCharDevice before allowing colors.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.653438+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.260387+01:00","closed_at":"2026-01-30T08:52:37.260387+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-do1","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.571211+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-dro","title":"docs/README_v0.md: replace bare URL with markdown link","description":"In docs/README_v0.md around line 18-20: Replace the bare URL with a markdown link to resolve MD034 and render better.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.065353+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.088641+01:00","closed_at":"2026-01-30T08:52:35.088641+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-dro","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:22.766781+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-eam","title":"registry.go: sort ListAvailable for deterministic output","description":"In internal/provider/registry.go around line 99-111: Map iteration order in Go is non-deterministic. If callers expect a consistent order (e.g., for display or testing), consider sorting the result with sort.Strings(available).","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:19.393806+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.14594+01:00","closed_at":"2026-01-30T08:52:32.14594+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-eam","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:25.693363+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-eu2","title":"docs/troubleshooting.md: replace bare URL with markdown link","description":"In docs/troubleshooting.md around line 254: Replace the bare URL with a markdown link to avoid MD034 and improve rendering.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.328879+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.109943+01:00","closed_at":"2026-01-30T08:52:35.109943+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-eu2","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.127861+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-g2g","title":"provider.go: use Source type for Suggestion.Source field","description":"In internal/provider/provider.go around line 91-98: The Suggestion.Source field is a plain string, while internal/suggest/sources.go defines a Source type alias with constants (SourceSession, SourceCWD, SourceGlobal, SourceAI). Consider using the same type or constants to avoid magic strings and improve consistency.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:20.640121+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.142921+01:00","closed_at":"2026-01-30T08:52:32.142921+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-g2g","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:27.278508+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-gvk","title":"commands_test.go: rebind loop variable before t.Run","description":"In internal/storage/commands_test.go around line 686-693: Loop variable tt is captured by reference in the closure passed to t.Run. With t.Parallel(), the goroutine may execute after the next iteration reassigns tt. Rebind with tt := tt before the t.Run call.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:39.324669+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.6528+01:00","closed_at":"2026-01-30T08:53:47.6528+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-gvk","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:42.924523+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-h8y","title":"Stream G: Suggestion Ranking Engine","description":"**Wave 2 - Depends on Stream B (storage)**\n\nDeliverables:\n- internal/suggest/ranker.go - Scoring algorithm\n- internal/suggest/sources.go - Session/CWD/Global sources\n- internal/suggest/normalize.go - Command normalization\n\nScoring Formula:\nscore = (source_weight * 0.4) + (recency_score * 0.3) + (success_score * 0.2) + (affinity_score * 0.1)\n\nSource Weights: session=1.0, cwd=0.7, global=0.4\nRecency: 1.0 / (1 + log(hours_since_use + 1))\nSuccess: success_count / (success_count + failure_count)\nAffinity: 1.0 if same tool prefix as last command\n\nAcceptance Criteria:\n- Implements scoring formula\n- Queries all three scopes\n- Merges and deduplicates\n- \u003c 50ms latency for 10K history\n- 85% test coverage","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:00.940294+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T19:43:01.072981+01:00","closed_at":"2026-01-29T19:43:01.072981+01:00","close_reason":"Implementation complete: all files created, tests passing, lint clean","labels":["ai-terminal-0cx"],"dependencies":[{"issue_id":"ai-terminal-h8y","depends_on_id":"ai-terminal-0cx.2","type":"blocks","created_at":"2026-01-29T17:59:35.892113+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-har","title":"cache.go: use time.Duration for default TTL","description":"In internal/storage/cache.go around line 73-80: Prefer time.Duration for the default TTL. Improves readability and reduces unit-conversion mistakes. Change entry.ExpiresAtUnixMs = entry.CreatedAtUnixMs + (24 * 60 * 60 * 1000) to entry.ExpiresAtUnixMs = entry.CreatedAtUnixMs + (24 * time.Hour).Milliseconds()","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.100245+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.551982+01:00","closed_at":"2026-01-30T08:53:47.551982+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-har","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.118669+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-he6","title":"docs/getting-started.md: align Homebrew install instructions","description":"In docs/getting-started.md around line 10-15: This file uses a tap+install flow, while docs/installation.md uses 'brew install runger/tap/clai'. Pick one and keep it consistent to avoid user confusion.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:15.122924+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:34.998878+01:00","closed_at":"2026-01-30T08:52:34.998878+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-he6","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:21.811281+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-i15","title":"ranker_test.go: gate flaky performance test behind env var","description":"In internal/suggest/ranker_test.go around line 595-673: The performance test TestRanker_Performance_10KCommands_Under50ms is flaky in CI due to the hard 50ms assertion and t.Parallel. Update the test to be gated behind an environment variable (e.g. require RUN_PERF_TESTS=true) or a build tag so it only runs intentionally. Modify the test to check os.Getenv('RUN_PERF_TESTS') at the start and call t.Skip when not set.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.830694+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.694461+01:00","closed_at":"2026-01-30T08:57:29.694461+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-i15","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.8513+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-j35","title":"config_cmd_test.go: exercise production key listing","description":"In internal/cmd/config_cmd_test.go around line 8-52: allConfigKeys() is defined in the test file, so the test only validates its own hard-coded list. It will still pass even if the real config/list command regresses. Assert against the actual list source from the config module.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:43.303422+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:59:04.39671+01:00","closed_at":"2026-01-30T08:59:04.39671+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-j35","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:46.381573+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg","title":"Fish-like UX Phase 1","description":"Deliver Phase 1 fish-like UX across zsh/bash/fish: ghost text where supported, suggestion/history pickers, and non-blocking interactions per specs/tech_fish_like_ux.md.","status":"open","priority":2,"issue_type":"epic","owner":"phpworkx@gmail.com","created_at":"2026-02-03T10:44:13.925863+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T18:23:55.018322+01:00","labels":["planned"]}
{"id":"ai-terminal-kbg.1","title":"Add shell-friendly suggestion/history APIs and toggles","description":"Description:\n- Provide shell-friendly outputs for suggestions and history (plain lines; optional JSON).\n- Add scope selection for history (session/cwd/global) and prefix filtering for picker use.\n- Add `clai on`/`clai off` plus `CLAI_OFF=1` handling that shell scripts can read.\n\nAcceptance:\n- `clai suggest` supports multi-result output with a fast, no-frills format and optional metadata.\n- `clai history` can output raw command lists with explicit scope selection and prefix filtering.\n- `clai on`/`clai off` toggles suggestion UX in current session; `CLAI_OFF=1` disables without breaking shell usage.\n","notes":"CHECKPOINT: Step 5a verification passed at 2026-02-03T13:08:04+01:00","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-03T10:44:32.781822+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T13:23:27.96859+01:00","closed_at":"2026-02-03T13:23:27.968592+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-kbg.1","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T10:44:32.782951+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.10","title":"bug(zsh): backspace then right-arrow accepts stale remainder","description":"Repro:\n- In zsh with ghost suggestion visible, backspace within buffer.\n- Press Right Arrow to accept suggestion.\n\nActual:\n- Right Arrow completes using stale suggestion remainder; trailing characters (e.g., 'rc') remain ghosted/light gray and are appended incorrectly.\n  Example: intended 'source ~/.zshrc' becomes 'source ~/.zshrcrc'.\n\nExpected:\n- Suggestion updates/clears after backspace; Right Arrow accepts current suggestion only.\n\nNotes:\n- Likely stale suggestion not refreshed or accept logic not validating against current buffer.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T18:37:10.692964+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T19:10:17.052099+01:00","closed_at":"2026-02-03T19:10:17.052099+01:00","close_reason":"Fixed in c0ac523: _ai_forward_char now validates _AI_CURRENT_SUGGESTION is a prefix of BUFFER before accepting. Stale suggestions after backspace are rejected. Test added.","dependencies":[{"issue_id":"ai-terminal-kbg.10","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T18:37:10.695813+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.11","title":"zsh menu UX: reverse order + paging on up","description":"Goal:\nImplement requested zsh auto-completion menu UX.\n\nPlan:\n1) Order: render list bottom-to-up so line 5 is next suggestion; line 1 is 5th suggestion.\n2) Navigation: Down moves downward in list toward first suggestion; when at first suggestion, Down does nothing.\n3) Paging: when cursor is at top and Up is pressed, load next page (next 5 items), keep list size constant, and move cursor to bottom.\n4) Bounds: when no more items above, Up does nothing (optionally brief 'no more' hint).\n5) Update render + state machine to support reversed ordering and paging without stale selections.\n6) Add regression checklist for open, paging, bounds, and close-on-edit.\n\nAcceptance:\n- Initial menu shows suggestions in reversed order (newest/closest at bottom).\n- Down arrow does nothing at first suggestion.\n- Up at top paginates; cursor lands at bottom; list updates to next 5.\n- No stale items; menu state remains consistent across paging.\n","status":"in_progress","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-03T20:16:49.542133+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T05:30:04.943602+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.11","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T20:16:49.543982+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.12","title":"bug(bash): init teaser not shown","description":"Repro:\n- Start a new bash shell on macOS.\n\nActual:\n- Only macOS zsh migration message appears; no clai init teaser:\n  The default interactive shell is now zsh...\n  bash-3.2$\n\nExpected:\n- clai startup teaser is shown for bash.\n\nNotes:\n- Possibly same root cause as ai-terminal-kbg.8 (bash teaser/session id not shown).","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T20:20:19.404033+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T05:21:59.035366+01:00","closed_at":"2026-02-04T05:21:59.035366+01:00","close_reason":"Duplicate of ai-terminal-kbg.8, already fixed in commit d2de315 (install targets .bash_profile on macOS).","dependencies":[{"issue_id":"ai-terminal-kbg.12","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T20:20:19.405265+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.13","title":"bug(bash): auto-completion menu not shown","description":"Repro:\n- In bash with clai integration, try to open clai completion menu / history picker.\n- Press Up Arrow expecting menu; use Tab for suggestions.\n\nActual:\n- Up Arrow cycles normal bash history; no clai menu appears.\n- Completion menu not shown at all.\n\nExpected:\n- clai completion/history picker should appear per fish-like UX requirements.\n\nNotes:\n- Likely missing Readline bindings for menu/picker in bash integration.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T20:21:40.422936+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T05:27:11.509381+01:00","closed_at":"2026-02-04T05:27:11.509381+01:00","close_reason":"Added visual picker menu with ANSI rendering and Enter key handling via two-step readline macro","dependencies":[{"issue_id":"ai-terminal-kbg.13","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T20:21:40.424314+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.14","title":"CI: enable pipefail for piped test commands","description":"CI pipeline piped test commands (lines 30, 112 in ci.yml) can hide go test failures because pipefail is not set. Add 'set -o pipefail' before piped commands in both the 'Run tests with race detector' and 'Run interactive shell tests' steps.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:52.405717+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:18:33.271288+01:00","closed_at":"2026-02-04T12:18:33.271288+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-kbg.14","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:52.406797+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.15","title":"CI+Makefile: pin gotestfmt and gotestsum versions","description":"Pin gotestfmt in ci.yml (lines 27, 109) from @latest to a fixed version (e.g. @v2.5.0). Also pin gotestsum in Makefile install-dev (line 45) from @latest to a fixed version (e.g. @v1.13.0) for reproducible builds.","status":"closed","priority":3,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:52.739859+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:19:04.41353+01:00","closed_at":"2026-02-04T12:19:04.41353+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-kbg.15","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:52.740722+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.16","title":"docs: add language tag to fenced code block in shell-integration.md","description":"The ASCII diagram code fence at line 23 in docs/shell-integration.md is missing a language tag (MD040). Change bare triple-backtick to backtick-text.","status":"in_progress","priority":4,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:53.047339+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:29.363249+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.16","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:53.049451+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.17","title":"fix: validate negative offset/limit in buildHistoryQuery","description":"buildHistoryQuery in history_cmd.go (line 128) passes historyOffset directly from cobra CLI flag without validation. Negative values flow through to storage.CommandQuery.Offset and then to SQL. Clamp or reject negative values for both offset and limit. Also clamp negative offset in storage/commands.go (line 207) as defense-in-depth.","status":"in_progress","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:53.360009+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:29.494873+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.17","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:53.362343+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.18","title":"fix: make TestGetRCFiles_DarwinBash order-independent","description":"TestGetRCFiles_DarwinBash in install_test.go (lines 108-123) asserts got[0] is .bash_profile and got[1] is .bashrc. Use presence checks instead of index-based assertions to avoid order-dependent flakiness.","status":"in_progress","priority":3,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:53.690519+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:29.630452+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.18","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:53.692586+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.19","title":"fix: pre-allocate addedFiles slice in install.go","description":"install.go line 72: change 'var addedFiles []string' to 'addedFiles := make([]string, 0, len(rcFiles))' to pre-allocate and avoid potential linter warning.","status":"in_progress","priority":4,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:54.026426+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:29.773477+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.19","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:54.02894+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.2","title":"Zsh fish-like UX integration (ghost text + pickers)","description":"Description:\n- Replace right-prompt hint with true inline ghost text via POSTDISPLAY.\n- Implement suggestion picker (Tab) and history picker (Up) using ZLE widgets and `zle -M`.\n- Add keybindings for accept full/next token, dismiss (Esc), and scope switching (Ctrl+x s/d/g).\n- Merge clai suggestions with native completions; suppress zsh-autosuggestions while active.\n- Debounce/cancel/stale-result handling to avoid blocking typing.\n\nAcceptance:\n- Ghost text visibility matches spec (hidden when buffer empty, cursor not at EOL, picker open, or UI paused).\n- Right Arrow accepts full suggestion; Alt+Right accepts next token.\n- Tab opens picker with ≤5 merged suggestions; Esc restores original buffer.\n- Up Arrow opens history picker with scope switching; selection replaces buffer without executing.\n- Typing remains responsive; stale suggestions discarded.\n","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-03T10:44:38.395978+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T15:08:27.492856+01:00","closed_at":"2026-02-03T15:08:27.492858+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-kbg.2","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T10:44:38.396725+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-kbg.2","depends_on_id":"ai-terminal-kbg.1","type":"blocks","created_at":"2026-02-03T10:45:15.699451+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.20","title":"fix(bash): _clai_disable should remove per-command completions","description":"In clai.bash, _clai_disable only runs 'complete -r -D' but on bash \u003c4 completions are registered per-command (git npm yarn docker kubectl make go cargo python pip). Store the command list in _CLAI_COMMANDS when registering and iterate it in _clai_disable to call 'complete -r' for each.","status":"in_progress","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:54.347648+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:29.906099+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.20","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:54.348472+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.21","title":"fix(fish): preserve autosuggestion state across enable/disable","description":"In clai.fish, enabling clai blindly sets fish_autosuggestion_enabled=0 and _clai_disable blindly restores to 1. If user had autosuggestions already disabled, we'd wrongly enable them. Save the prior value in _clai_prev_autosuggestion before disabling, restore it in _clai_disable (fallback to 1 if not set).","status":"in_progress","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:54.635124+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:30.167519+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.21","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:54.644501+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.22","title":"fix: docker-compose test-docker should abort on container exit","description":"Makefile test-docker target (lines 105, 108): docker-compose up can hang if test container exits but other services keep running. Add --abort-on-container-exit or --exit-code-from to both docker-compose and docker compose invocations.","status":"in_progress","priority":3,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:54.91496+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:30.339616+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.22","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:54.915766+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.23","title":"fix: improve init_test.go function body extraction","description":"Two issues in init_test.go: (1) Widget regex at line 274 uses [^}]+ which stops at first }, missing nested braces. Use a pattern that checks presence without full body extraction. (2) Fixed offsets downStart+400 and upStart+800 at lines 414/424 are fragile. Find the next function boundary instead of using hardcoded offsets.","status":"in_progress","priority":3,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-04T12:12:55.188838+01:00","created_by":"Ronny Unger","updated_at":"2026-02-04T12:14:30.459165+01:00","dependencies":[{"issue_id":"ai-terminal-kbg.23","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-04T12:12:55.190712+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.3","title":"Bash fish-like UX integration (picker-only)","description":"Description:\n- Implement suggestion picker on Tab using Readline `COMPREPLY` and `menu-complete` cycling.\n- Add history picker on Up Arrow with scope switching (Ctrl+x s/d/g).\n- Merge clai suggestions ahead of native completions and dedupe.\n- Enforce bounded latency: fallback to native completions if clai is slow/unavailable.\n- Honor `CLAI_OFF=1` to disable clai UX in-session.\n\nAcceptance:\n- Tab opens picker; repeated Tab cycles suggestions; clai suggestions appear before native completions.\n- Up Arrow opens history picker; selection replaces buffer without executing; Esc cancels.\n- If clai is slow/unavailable, native completions return immediately.\n- Disabling clai restores default Readline behavior.\n","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-03T10:44:43.624181+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T15:09:00.959644+01:00","closed_at":"2026-02-03T15:09:00.959649+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-kbg.3","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T10:44:43.625021+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-kbg.3","depends_on_id":"ai-terminal-kbg.1","type":"blocks","created_at":"2026-02-03T10:45:18.154476+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.4","title":"Fish fish-like UX integration (ghost text + pickers)","description":"Description:\n- Integrate clai suggestions into fish autosuggestion pipeline for ghost text.\n- Implement suggestion picker (Tab) and history picker (Up) with scope switching (Ctrl+x s/d/g).\n- Add keybindings for accept full/next token and dismiss (Esc).\n- Suppress fish native autosuggestions while clai is active.\n- Ensure non-blocking suggestion fetch with debounce/staleness handling.\n\nAcceptance:\n- Ghost text appears inline from clai and hides under spec conditions.\n- Tab opens picker; Up opens history picker; Esc cancels and restores buffer.\n- Scope switching updates history picker results.\n- Typing remains responsive and clai can be disabled via `CLAI_OFF=1`.\n","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-03T10:44:48.554676+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T15:09:28.591895+01:00","closed_at":"2026-02-03T15:09:28.591898+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-kbg.4","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T10:44:48.55547+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-kbg.4","depends_on_id":"ai-terminal-kbg.1","type":"blocks","created_at":"2026-02-03T10:45:20.183329+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.5","title":"Update tests and docs for fish-like UX","description":"Description:\n- Update shell init script tests to cover new keybindings and picker behavior.\n- Refresh `specs/shell-integration-testing.md` with pickers, scope switching, and disable toggles.\n- Document new CLI flags/commands in `docs/` if added.\n\nAcceptance:\n- Tests pass with updated shell integration expectations.\n- Manual integration checklist covers pickers, scope switching, and disable toggles across shells.\n- Docs mention any new CLI flags or toggles.\n","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-02-03T10:44:52.691848+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T15:12:31.925571+01:00","closed_at":"2026-02-03T15:12:31.925573+01:00","labels":["planned"],"dependencies":[{"issue_id":"ai-terminal-kbg.5","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T10:44:52.693662+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-kbg.5","depends_on_id":"ai-terminal-kbg.2","type":"blocks","created_at":"2026-02-03T10:45:23.294791+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-kbg.5","depends_on_id":"ai-terminal-kbg.3","type":"blocks","created_at":"2026-02-03T10:45:26.336588+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-kbg.5","depends_on_id":"ai-terminal-kbg.4","type":"blocks","created_at":"2026-02-03T10:45:29.319685+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.6","title":"bug(fish): init new shell does not show session id","description":"Repro:\n- start a new fish shell (fresh session)\n- observe clai startup banner\n\nActual:\n- banner shows truncated session id: '🤖 clai [{{CLAI_S] Tab suggest | Alt+Enter accept | ?\"describe task\"'\n\nExpected:\n- banner shows full rendered session id (e.g., 8-char short id)\n\nNotes:\n- looks like template placeholder not being rendered in fish startup message.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T18:22:50.810914+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T19:48:25.687149+01:00","closed_at":"2026-02-03T19:48:25.687149+01:00","close_reason":"Fixed: install command now writes thin eval/source loader instead of raw script with unresolved {{CLAI_SESSION_ID}} placeholder. Also changed init.go to use ReplaceAll for robustness.","dependencies":[{"issue_id":"ai-terminal-kbg.6","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T18:22:50.812675+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.7","title":"bug(zsh): typing commands inserts unrelated text","description":"Repro:\n- In zsh with clai integration enabled, type a command (e.g., 'bash').\n\nActual:\n- Input buffer shows raw prompt control sequences + suggestion text inserted, e.g.:\n  bash^[[38;5;242m format.sh^[[0m\n\nExpected:\n- Suggestion is rendered without inserting raw control sequences into the buffer.\n\nNotes:\n- Looks like right-prompt/suggestion rendering is being injected into the buffer instead of display-only.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T18:24:11.0114+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T18:30:11.031614+01:00","closed_at":"2026-02-03T18:30:11.031614+01:00","close_reason":"Fixed in 4715305: switched from escape sequences to region_highlight for POSTDISPLAY coloring. Regression test added in 8601c9f.","dependencies":[{"issue_id":"ai-terminal-kbg.7","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T18:24:11.013755+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.8","title":"bug(bash): init teaser with session id not shown","description":"Repro:\n- Start a new bash shell on macOS.\n\nActual:\n- The default macOS zsh migration message prints instead of clai banner (session id teaser not shown):\n  The default interactive shell is now zsh...\n\nExpected:\n- clai startup teaser with session id is shown for bash.\n\nNotes:\n- Likely interacting with macOS default bash login message; verify clai init hook placement.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T18:26:39.235006+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T20:24:09.863018+01:00","closed_at":"2026-02-03T20:24:09.863018+01:00","close_reason":"Fixed: install command now targets .bash_profile on macOS instead of .bashrc, since Terminal.app opens login shells which only read .bash_profile.","dependencies":[{"issue_id":"ai-terminal-kbg.8","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T18:26:39.236562+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kbg.9","title":"bug(zsh): auto-complete menu not closed on left/backspace","description":"Repro:\n- In zsh, open the clai suggestion menu (down arrow / Ctrl+Space).\n- Press Left Arrow or Backspace and type a different prefix.\n\nActual:\n- Menu remains open and shows stale suggestions from previous command, e.g.:\n  $ ma (sour → source ~/.zshrc) (source → source ~/.zshrc)\n  History (session) (↑↓, Enter, Ctrl+C):\n     source ~/.zshrc\n   → source ~/.zshrc\n     source ~/.zshrc\n     source ~/.zshrc\n\nExpected:\n- Menu closes on Left Arrow or Backspace; suggestions refresh for new prefix.\n\nNotes:\n- Likely missing bindings to cancel menu on cursor move/backspace, or stale menu state not reset.","status":"closed","priority":2,"issue_type":"bug","owner":"phpworkx@gmail.com","created_at":"2026-02-03T18:34:42.718927+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T18:40:43.332767+01:00","closed_at":"2026-02-03T18:40:43.332767+01:00","close_reason":"Fixed in 2efc829: added _clai_dismiss_picker() called from self-insert, backspace, left-arrow, home, end, and paste widgets to close stale picker menu on editing actions","dependencies":[{"issue_id":"ai-terminal-kbg.9","depends_on_id":"ai-terminal-kbg","type":"parent-child","created_at":"2026-02-03T18:34:42.72043+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kd8","title":"docs/features.md: add language hint to fenced block","description":"In docs/features.md around line 13-18: Add a language hint (e.g., 'text') to the fenced block to satisfy markdownlint MD040.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.766439+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:34.972936+01:00","closed_at":"2026-01-30T08:52:34.972936+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-kd8","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.840754+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-kgj","title":"CI: update Go version to 1.24 in workflows","description":"CI and release workflows are using older Go versions while go.mod specifies go 1.24.0. Update the 'Set up Go' steps in .github/workflows/ci.yml and .github/workflows/release.yml to set go-version: '1.24' (or '1.24.0') so the actions use Go 1.24 to match the module declaration.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:22.773848+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.133048+01:00","closed_at":"2026-01-30T08:52:35.133048+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-kgj","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:29.581346+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-l4g","title":"docs/ai-providers.md: add language tag to fenced example","description":"In docs/ai-providers.md around line 112-121: Add a language tag (e.g., 'text') to the fenced example to satisfy markdownlint MD040.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.507759+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:34.950051+01:00","closed_at":"2026-01-30T08:52:34.950051+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-l4g","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.595055+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-mv5","title":"cache.go: remove unbounded goroutine for hit_count update","description":"In internal/storage/cache.go around line 48-53: The anonymous goroutine that updates hit_count should be removed to avoid unbounded goroutines. Perform a synchronous, best-effort update instead by calling s.db.ExecContext with the request's context (use the function's ctx parameter rather than context.Background()), execute the UPDATE inline, and ignore/log the error as appropriate.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:29.496437+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.528269+01:00","closed_at":"2026-01-30T08:53:47.528269+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-mv5","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:35.859797+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-n3e","title":"handlers.go: extract duplicated session info logic","description":"In internal/daemon/handlers.go around line 244-254: The same pattern for extracting osName and shell from sessionManager.Get() is repeated in TextToCommand, NextStep, and Diagnose. Extract to a helper method getSessionContext(sessionID string) (osName, shell string).","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:21.449498+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:40.483607+01:00","closed_at":"2026-01-30T08:53:40.483607+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-n3e","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:28.011465+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-na6","title":"install.go: handle f.Stat() and os.ReadFile errors","description":"In internal/cmd/install.go around line 43-134: The code in runInstall ignores errors from f.Stat() and os.ReadFile which can lead to a nil-deref panic when calling info.Size() and hides read failures. Change the block that currently does 'info, _ := f.Stat()' and 'content, _ := os.ReadFile(rcFile)' to check and handle errors: call info, err := f.Stat() and if err \\!= nil return a wrapped error, ensure info \\!= nil before using info.Size(), and call content, err := os.ReadFile(rcFile) and if err \\!= nil return a wrapped error (or skip newline check) before accessing content[len(content)-1]. Update the runInstall function to return descriptive errors for f.Stat and os.ReadFile failures so the subsequent writes (f.WriteString) are safe.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:21.308467+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.378005+01:00","closed_at":"2026-01-30T08:52:37.378005+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-na6","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:28.375318+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-nja","title":"Arrow-up history preview (show last N matches)","description":"When pressing arrow-up, show a preview of the last 5 commands matching current input instead of cycling one-by-one.\n\n**Inspiration:** fzf history search, atuin shell history\n\n**Technical approach:**\n1. Override up-arrow ZLE widget (up-line-or-history)\n2. If BUFFER is non-empty, show dropdown/overlay with matching history\n3. Use Zsh's zle -M for message display or POSTDISPLAY\n4. Arrow keys navigate, Enter selects\n5. Escape cancels\n\n**Complexity:** High - requires overlay/popup UI in terminal\n\n**Challenges:**\n- Terminal doesn't have native popup/dropdown support\n- Need to handle terminal resize, scrollback\n- May need to clear/restore display after selection\n\n**Alternative:** Integrate with fzf if available (fzf --history)\n\n**Files:**\n- internal/cmd/shell/zsh/clai.zsh - ZLE widget\n- internal/cmd/shell/bash/clai.bash - bind -x for up-arrow\n- internal/cmd/shell/fish/clai.fish - bind up for fish","notes":"On hold per user request","status":"closed","priority":4,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-28T19:08:53.733901+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:38:43.492738+01:00","closed_at":"2026-02-03T06:38:43.492738+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-nja","depends_on_id":"ai-terminal-0zs","type":"parent-child","created_at":"2026-01-28T19:09:13.187737+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-noh","title":"google.go: improve CLI detection robustness","description":"In internal/provider/google.go around line 171-182: Using strings.HasSuffix and strings.Contains to detect the CLI type is fragile. Consider storing the CLI type during Available() detection or using filepath.Base.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:20.890875+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.128516+01:00","closed_at":"2026-01-30T08:52:32.128516+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-noh","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:27.501912+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-ofi","title":"status.go: fix import of non-existent claude package","description":"In internal/cmd/status.go, the file imports the non-existent claude package which will cause a compilation error. Change the import to github.com/runger/clai/internal/daemon and update the call to claude.IsDaemonRunning() on line 42 to daemon.IsRunning().","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:35:49.69165+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:41:02.195198+01:00","closed_at":"2026-01-30T08:41:02.195198+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-ofi","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:35:57.28093+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pex","title":"Stream C: clai-shim (Thin Client)","description":"**Wave 2 - Depends on Stream A (proto)**\n\nDeliverables:\n- cmd/clai-shim/main.go\n- cmd/clai-shim/commands/*.go (root, session, log, suggest, textcmd)\n- internal/ipc/client.go - gRPC client wrapper\n- internal/ipc/dial.go - Socket connection\n- internal/ipc/spawn.go - Daemon spawning\n\nSubcommands: session-start, session-end, log-start, log-end, suggest, text-to-command\n\nFire-and-Forget Contract:\n- Logging: 10ms timeout, ignore errors\n- Suggestions: 50ms timeout, return empty on timeout\n- Silent failure (exit 0) on all errors\n\nAcceptance Criteria:\n- Connects to Unix socket ~/.clai/run/clai.sock\n- Spawns daemon if socket missing\n- \u003c 10ms startup time\n- Fire-and-forget for logging\n- 75% test coverage","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:00.734454+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T19:43:01.053243+01:00","closed_at":"2026-01-29T19:43:01.053243+01:00","close_reason":"Implementation complete: all files created, tests passing, lint clean","labels":["ai-terminal-0cx"],"dependencies":[{"issue_id":"ai-terminal-pex","depends_on_id":"ai-terminal-0cx.1","type":"blocks","created_at":"2026-01-29T17:59:35.803979+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pgi","title":"ph1: review feedback","status":"closed","priority":2,"issue_type":"epic","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:28:25.352563+01:00","created_by":"Ronny Unger","updated_at":"2026-02-03T06:38:43.479737+01:00","closed_at":"2026-02-03T06:38:43.479737+01:00","close_reason":"Closed"}
{"id":"ai-terminal-pgi.1","title":"sonar: reduce cognitive complexity in cmd/*.go","description":"SonarCloud go:S3776: install.go, logs.go, uninstall.go have high cognitive complexity. Refactor to reduce nesting and extract helper functions.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T09:20:18.584894+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T09:25:31.464697+01:00","closed_at":"2026-01-30T09:25:31.464697+01:00","close_reason":"Reviewed - complexity is acceptable for the functionality; files are well-structured","dependencies":[{"issue_id":"ai-terminal-pgi.1","depends_on_id":"ai-terminal-pgi","type":"parent-child","created_at":"2026-01-30T09:20:18.58712+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pgi.2","title":"sonar: reduce cognitive complexity in suggest/ranker.go","description":"SonarCloud go:S3776: ranker.go has high cognitive complexity. Refactor scoring logic to reduce nesting.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T09:20:18.81401+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T09:25:15.834605+01:00","closed_at":"2026-01-30T09:25:15.834605+01:00","close_reason":"Fixed by refactoring agents","dependencies":[{"issue_id":"ai-terminal-pgi.2","depends_on_id":"ai-terminal-pgi","type":"parent-child","created_at":"2026-01-30T09:20:18.814984+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pgi.3","title":"sonar: reduce cognitive complexity in provider/*.go","description":"SonarCloud go:S3776: anthropic.go, google.go, openai.go have high cognitive complexity. Refactor API handling logic.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T09:20:19.04648+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T09:25:15.859411+01:00","closed_at":"2026-01-30T09:25:15.859411+01:00","close_reason":"Fixed by refactoring agents","dependencies":[{"issue_id":"ai-terminal-pgi.3","depends_on_id":"ai-terminal-pgi","type":"parent-child","created_at":"2026-01-30T09:20:19.047377+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pgi.4","title":"sonar: fix string duplication across codebase","description":"SonarCloud go:S1192: Extract duplicated strings to constants in handlers.go, context.go, sessions.go, clai-shim/main.go","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T09:20:19.303458+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T09:25:15.885261+01:00","closed_at":"2026-01-30T09:25:15.885261+01:00","close_reason":"Fixed by refactoring agents","dependencies":[{"issue_id":"ai-terminal-pgi.4","depends_on_id":"ai-terminal-pgi","type":"parent-child","created_at":"2026-01-30T09:20:19.304399+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pgi.5","title":"sonar: fix shell script issues in hooks/clai.bash","description":"SonarCloud MAJOR: Add return statements, fix stderr redirects, fix positional parameter assignments in hooks/clai.bash","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T09:20:19.537686+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T09:25:15.907849+01:00","closed_at":"2026-01-30T09:25:15.907849+01:00","close_reason":"Fixed by refactoring agents","dependencies":[{"issue_id":"ai-terminal-pgi.5","depends_on_id":"ai-terminal-pgi","type":"parent-child","created_at":"2026-01-30T09:20:19.538558+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pgi.6","title":"sonar: use passed context instead of background in cache.go","description":"SonarCloud MAJOR: cache.go uses context.Background() when a context is already available. Use the passed context instead.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T09:20:19.762587+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T09:25:23.708215+01:00","closed_at":"2026-01-30T09:25:23.708215+01:00","close_reason":"False positive - cache.go correctly uses passed context","dependencies":[{"issue_id":"ai-terminal-pgi.6","depends_on_id":"ai-terminal-pgi","type":"parent-child","created_at":"2026-01-30T09:20:19.763442+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pno","title":"anthropic.go: preallocate suggestions slice","description":"In internal/provider/anthropic.go around line 173-176: The slice 'suggestions' in parseCommandResponse is created without preallocation triggering golangci-lint. Change its initialization to preallocate capacity for up to 3 entries (e.g., make([]Suggestion, 0, 3)) since the logic caps suggestions at 3 so the capacity is sufficient.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:36.880972+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.114467+01:00","closed_at":"2026-01-30T08:52:32.114467+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-pno","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:39.551066+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-pzk","title":"sessions_test.go: add t.Parallel() to subtests","description":"In internal/storage/sessions_test.go around line 170-181: The table-driven subtests don't call t.Parallel(). For consistency with other tests in this file and to enable parallel subtest execution, add t.Parallel() to each subtest.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:32.741564+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.746249+01:00","closed_at":"2026-01-30T08:53:47.746249+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-pzk","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:35.439519+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-q7v","title":"patterns_test.go: guard against missing pattern names","description":"In internal/sanitize/patterns_test.go around line 60-66: If a pattern name changes or is removed, pattern.Regex.MatchString will panic. Add a helper function mustPattern that t.Fatalf when a named pattern is missing to make failures clearer and safer.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:31.043343+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.708603+01:00","closed_at":"2026-01-30T08:57:29.708603+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-q7v","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:34.005553+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-riv","title":"docs/installation.md: fix table separator spacing","description":"In docs/installation.md around line 92-98: The separator row needs padding to satisfy the configured table style (markdownlint MD060).","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:15.637815+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.02145+01:00","closed_at":"2026-01-30T08:52:35.02145+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-riv","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:22.5973+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-rw6","title":"lifecycle.go: fix goroutine leak and add signal.Stop","description":"In internal/daemon/lifecycle.go around line 28-45: If server.Start(ctx) returns before a signal is received, the goroutine on line 32 will block forever on sigChan. Additionally, signal.Stop(sigChan) should be called to stop signal delivery when no longer needed. Add a select on ctx.Done() in the signal handler goroutine and call signal.Stop(sigChan) with defer.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:35.903216+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:40.493385+01:00","closed_at":"2026-01-30T08:53:40.493385+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-rw6","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:38.859314+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-s7p","title":"patterns.go: broaden Bearer token pattern","description":"In internal/sanitize/patterns.go around line 62-66: The Bearer token regex requires a 3-part JWT-like structure which misses simpler bearer tokens that don't follow JWT format (e.g., Bearer abc123def456). Consider broadening the pattern or adding a separate pattern for non-JWT bearer tokens.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:18.65736+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.700454+01:00","closed_at":"2026-01-30T08:57:29.700454+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-s7p","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:25.015706+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-u3h","title":"context.go: trim recentCmds at construction","description":"In internal/provider/context.go around line 16-23: Consider trimming recentCmds at construction to enforce MaxRecentCommands. This keeps prompt sizes bounded even if callers forget to call TrimRecentCommands. Update NewContextBuilder to set recentCmds: TrimRecentCommands(recentCmds) instead of recentCmds: recentCmds.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:17.356287+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.122971+01:00","closed_at":"2026-01-30T08:52:32.122971+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-u3h","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.360545+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-uhl","title":"Stream E: CLI Commands \u0026 Shell Hooks","description":"**Wave 4 - Depends on Streams A, B**\n\nDeliverables:\n- cmd/clai/commands/*.go (install, uninstall, status, doctor, logs, config, ask, history, update, daemon)\n- internal/config/*.go (config, paths, validate)\n- hooks/clai.zsh, hooks/clai.bash, hooks/clai.psm1\n\nCLI Commands: install, uninstall, status, doctor, logs, config, ask, history, update, daemon start/stop\n\nShell Hooks: preexec/precmd for zsh/bash, PSReadLine for PowerShell\n\nAcceptance Criteria:\n- All commands from Section 10 implemented\n- clai install modifies rc files correctly\n- clai doctor checks dependencies\n- Shell hooks from Section 6 included\n- 70% test coverage","status":"closed","priority":2,"issue_type":"feature","owner":"phpworkx@gmail.com","created_at":"2026-01-29T17:58:39.968856+01:00","created_by":"Ronny Unger","updated_at":"2026-01-29T19:43:01.092267+01:00","closed_at":"2026-01-29T19:43:01.092267+01:00","close_reason":"Implementation complete: all files created, tests passing, lint clean","dependencies":[{"issue_id":"ai-terminal-uhl","depends_on_id":"ai-terminal-0cx.1","type":"blocks","created_at":"2026-01-29T17:59:36.251662+01:00","created_by":"Ronny Unger"},{"issue_id":"ai-terminal-uhl","depends_on_id":"ai-terminal-0cx.2","type":"blocks","created_at":"2026-01-29T17:59:36.335668+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-vcp","title":"config.go: derive directory from path in SaveToFile","description":"In internal/config/config.go around line 124-139: Config.SaveToFile ignores the provided path when creating directories by always calling DefaultPaths().EnsureDirectories(). Instead, derive the directory from the passed-in path and ensure that directory exists before writing. Update SaveToFile to compute dir := filepath.Dir(path), call os.MkdirAll(dir, 0755) or use a paths.EnsureDirectories variant targeted at dir, then proceed to yaml.Marshal(c) and os.WriteFile(path, data, 0644) so custom paths with missing parents are created correctly.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:22.420179+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.221599+01:00","closed_at":"2026-01-30T08:52:35.221599+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-vcp","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:29.331973+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-w4p","title":"README.md: add language identifier to code fence","description":"In README.md around line 40-45: Add a language identifier (e.g., 'bash') to the example code fence to satisfy markdownlint MD040.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:39.820604+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:35.155795+01:00","closed_at":"2026-01-30T08:52:35.155795+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-w4p","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:46.482264+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-xcf","title":"config_cmd.go: pass paths to listConfig to avoid redundant call","description":"In internal/cmd/config_cmd.go around line 39-59: The paths variable created at line 40 is only used in the setConfig case. For listConfig, config.DefaultPaths() is called again at line 83. Refactor listConfig to accept paths as parameter and update the call to pass paths.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:20.585898+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.284112+01:00","closed_at":"2026-01-30T08:52:37.284112+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-xcf","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:23.676043+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-xiu","title":"cache_test.go: allow small TTL tolerance","description":"In internal/storage/cache_test.go around line 179-213: If SetCached assigns CreatedAt/ExpiresAt using separate time.Now() calls, exact equality can be off by a few milliseconds. Add a small tolerance (e.g., 1s) to keep the test stable.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:35.075502+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.597663+01:00","closed_at":"2026-01-30T08:53:47.597663+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-xiu","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:39.084516+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-xk5","title":"patterns.go: return copy from GetSecretPatterns","description":"In internal/sanitize/patterns.go around line 74-77: GetSecretPatterns() returns the secretPatterns slice directly, which allows callers to mutate the shared slice. Return a copy if immutability is important, or document that the returned slice should not be modified.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:18.912268+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.703229+01:00","closed_at":"2026-01-30T08:57:29.703229+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-xk5","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:25.256136+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-xlb","title":"config_cmd.go: log warning when key fails to retrieve","description":"In internal/cmd/config_cmd.go around line 61-86: Line 70 silently continues when cfg.Get(key) returns an error. While this avoids breaking the listing, it could hide misconfiguration issues. Add a debug log or collect failed keys for a summary to improve debuggability.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:23.947408+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.306574+01:00","closed_at":"2026-01-30T08:52:37.306574+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-xlb","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:27.732227+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-xpi","title":"spawn_test.go: handle UserHomeDir errors in tests","description":"In internal/ipc/spawn_test.go around line 9-27: Errors from os.UserHomeDir() are ignored which can make failures misleading on systems without a resolvable home directory. Prefer failing fast with t.Fatalf when UserHomeDir fails.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:39.561885+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:57:29.680921+01:00","closed_at":"2026-01-30T08:57:29.680921+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-xpi","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:46.253172+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-xuy","title":"logs.go: prevent panic when n is negative in tailLogs","description":"In internal/cmd/logs.go around line 59-80: The tailLogs function can panic when n is negative because make([]string, 0, n) does not accept a negative capacity. Add a defensive validation at the start of tailLogs(filename string, n int) to reject non-positive values (n \u003c= 0) and return a clear error (e.g., 'invalid lines parameter') so callers (and the CLI flag logsLines) cannot pass a negative or zero value.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:22.186446+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.423412+01:00","closed_at":"2026-01-30T08:52:37.423412+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-xuy","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:29.073902+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-yzu","title":"handlers.go: retrieve actual lastCommand for tool affinity","description":"In internal/daemon/handlers.go, the lastCommand is currently hardcoded to an empty string, which means the tool affinity scoring in the ranker will not work as intended. To improve suggestion relevance, the actual last command from the session should be retrieved from the database here.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:35:46.089403+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:43:22.000777+01:00","closed_at":"2026-01-30T08:43:22.000777+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-yzu","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:35:57.043246+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-zj5","title":"doctor.go: fix import of non-existent claude package","description":"In internal/cmd/doctor.go, the file imports the non-existent claude package which will cause a compilation error. Change the import to github.com/runger/clai/internal/daemon and update the call to claude.IsDaemonRunning() to daemon.IsRunning().","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:35:51.260806+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:41:02.221651+01:00","closed_at":"2026-01-30T08:41:02.221651+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-zj5","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:35:57.389319+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-zjf","title":"logs.go: fix tail logic line corruption across chunks","description":"In internal/cmd/logs.go around line 78-108: The tail logic can corrupt lines spanning read chunks because splitLines(chunk) is called per chunk independently. Fix read loop in the function containing variables offset/readSize/chunkLines by carrying a partial fragment between iterations: keep a string 'remainder' that holds the (incomplete) leading fragment from the previous read, prepend it to the current chunk before calling splitLines, then update 'remainder' to the first element if the chunk did not start on a line boundary (or to the last element if you process chunks backwards), ensuring you stitch partial lines across chunk boundaries and only append complete lines into 'lines'.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:21.765235+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:37.401623+01:00","closed_at":"2026-01-30T08:52:37.401623+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-zjf","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:28.730854+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-zq1","title":"cache_test.go: replace time.Sleep with polling loop","description":"In internal/storage/cache_test.go around line 100-144: Replace the fixed time.Sleep(100 * time.Millisecond) in TestSQLiteStore_GetCached_IncrementsHitCount with a polling loop that queries the DB via store.DB().QueryRowContext (same SELECT hit_count ...) until hitCount \u003e= 3 or a timeout elapses (e.g., 1-2s), sleeping a short interval (e.g., 10-50ms) between polls. Fail the test if the timeout expires. Keep the final assertion that hitCount \u003e= 3.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:29.224527+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:53:47.574586+01:00","closed_at":"2026-01-30T08:53:47.574586+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-zq1","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:35.62982+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-zsb","title":"anthropic.go: handle numbered/bulleted lists in fixes loop","description":"In internal/provider/anthropic.go around line 254-268: The fixes loop currently only appends when inFixes is true and ignores numbered/bulleted lists. Update the logic around cleanCommandPrefix(line) and the inFixes check so that a cleaned line that matches a numbered/bullet pattern (e.g., starts with '1.', '1)', '-' or '*') is treated as the start of the fixes section: detect that pattern, set inFixes = true, then create the Suggestion and append to fixes so numbered/bulleted commands are not dropped.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:45.313125+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:32.119822+01:00","closed_at":"2026-01-30T08:52:32.119822+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-zsb","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:48.42529+01:00","created_by":"Ronny Unger"}]}
{"id":"ai-terminal-zxe","title":"docs/quickstart.md: add language tags to code blocks","description":"In docs/quickstart.md around line 37-40 and 89-92: Both fenced blocks are missing a language and include $ prompts without output. Add language tags (e.g., 'text' or 'bash') and remove prompt markers to satisfy MD040/MD014.","status":"closed","priority":2,"issue_type":"task","owner":"phpworkx@gmail.com","created_at":"2026-01-30T08:31:16.924408+01:00","created_by":"Ronny Unger","updated_at":"2026-01-30T08:52:34.878118+01:00","closed_at":"2026-01-30T08:52:34.878118+01:00","close_reason":"Closed","dependencies":[{"issue_id":"ai-terminal-zxe","depends_on_id":"ai-terminal-pgi","type":"blocks","created_at":"2026-01-30T08:31:24.107511+01:00","created_by":"Ronny Unger"}]}
