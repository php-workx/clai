=== RUN   TestOpen_CreatesDatabase
=== PAUSE TestOpen_CreatesDatabase
=== NAME  
=== RUN   TestOpen_CreatesDirectory
=== PAUSE TestOpen_CreatesDirectory
=== NAME  
=== RUN   TestOpen_RunsMigrations
=== PAUSE TestOpen_RunsMigrations
=== NAME  
=== RUN   TestOpen_WALModeEnabled
=== PAUSE TestOpen_WALModeEnabled
=== NAME  
=== RUN   TestOpen_ForeignKeysEnabled
=== PAUSE TestOpen_ForeignKeysEnabled
=== NAME  
=== RUN   TestDB_SchemaVersion
=== PAUSE TestDB_SchemaVersion
=== NAME  
=== RUN   TestDB_Validate
=== PAUSE TestDB_Validate
=== NAME  
=== RUN   TestDB_Close
=== PAUSE TestDB_Close
=== NAME  
=== RUN   TestDB_PrepareStatement
=== PAUSE TestDB_PrepareStatement
=== NAME  
=== RUN   TestMigrations_RefuseNewerVersion
=== PAUSE TestMigrations_RefuseNewerVersion
=== NAME  
=== RUN   TestMigrations_Idempotent
=== PAUSE TestMigrations_Idempotent
=== NAME  
=== RUN   TestLock_PreventsMultipleOpens
--- PASS: TestLock_PreventsMultipleOpens (0.14s)
=== NAME  
=== RUN   TestLock_ReleasedOnClose
--- PASS: TestLock_ReleasedOnClose (0.04s)
=== NAME  
=== RUN   TestLock_ConcurrentStartup
--- PASS: TestLock_ConcurrentStartup (0.10s)
=== NAME  
=== RUN   TestLock_TimeoutBehavior
--- PASS: TestLock_TimeoutBehavior (0.23s)
=== NAME  
=== RUN   TestIsLocked
--- PASS: TestIsLocked (0.03s)
=== NAME  
=== RUN   TestGetLockHolderPID
--- PASS: TestGetLockHolderPID (0.03s)
=== NAME  
=== RUN   TestOpen_ReadOnly
=== PAUSE TestOpen_ReadOnly
=== NAME  
=== RUN   TestDB_ConcurrentReads
=== PAUSE TestDB_ConcurrentReads
=== NAME  
=== RUN   TestSchemaValidity_SessionTable
=== PAUSE TestSchemaValidity_SessionTable
=== NAME  
=== RUN   TestSchemaValidity_CommandEventTable
=== PAUSE TestSchemaValidity_CommandEventTable
=== NAME  
=== RUN   TestSchemaValidity_TransitionTable
=== PAUSE TestSchemaValidity_TransitionTable
=== NAME  
=== RUN   TestSchemaValidity_CommandScoreTable
=== PAUSE TestSchemaValidity_CommandScoreTable
=== NAME  
=== RUN   TestSchemaValidity_SlotValueTable
=== PAUSE TestSchemaValidity_SlotValueTable
=== NAME  
=== RUN   TestSchemaValidity_ProjectTaskTable
=== PAUSE TestSchemaValidity_ProjectTaskTable
=== NAME  
=== RUN   TestSchemaValidity_ForeignKeyEnforced
=== PAUSE TestSchemaValidity_ForeignKeyEnforced
=== NAME  
=== RUN   TestV2Open_CreatesDatabase
=== PAUSE TestV2Open_CreatesDatabase
=== NAME  
=== RUN   TestV2Open_SchemaVersion
=== PAUSE TestV2Open_SchemaVersion
=== NAME  
=== RUN   TestV2Open_ValidateAll23Tables
=== PAUSE TestV2Open_ValidateAll23Tables
=== NAME  
=== RUN   TestV2Open_Idempotent
=== PAUSE TestV2Open_Idempotent
=== NAME  
=== RUN   TestV2Open_RefuseNewerVersion
=== PAUSE TestV2Open_RefuseNewerVersion
=== NAME  
=== RUN   TestV2_SessionTable
=== PAUSE TestV2_SessionTable
=== NAME  
=== RUN   TestV2_CommandEventTable
=== PAUSE TestV2_CommandEventTable
=== NAME  
=== RUN   TestV2_CommandTemplateTable
=== PAUSE TestV2_CommandTemplateTable
=== NAME  
=== RUN   TestV2_TransitionStatTable
=== PAUSE TestV2_TransitionStatTable
=== NAME  
=== RUN   TestV2_CommandStatTable
=== PAUSE TestV2_CommandStatTable
=== NAME  
=== RUN   TestV2_SlotStatTable
=== PAUSE TestV2_SlotStatTable
=== NAME  
=== RUN   TestV2_SlotCorrelationTable
=== PAUSE TestV2_SlotCorrelationTable
=== NAME  
=== RUN   TestV2_ProjectTypeStatTable
=== PAUSE TestV2_ProjectTypeStatTable
=== NAME  
=== RUN   TestV2_ProjectTypeTransitionTable
=== PAUSE TestV2_ProjectTypeTransitionTable
=== NAME  
=== RUN   TestV2_PipelineEventTable
=== PAUSE TestV2_PipelineEventTable
=== NAME  
=== RUN   TestV2_PipelineTransitionTable
=== PAUSE TestV2_PipelineTransitionTable
=== NAME  
=== RUN   TestV2_PipelinePatternTable
=== PAUSE TestV2_PipelinePatternTable
=== NAME  
=== RUN   TestV2_FailureRecoveryTable
=== PAUSE TestV2_FailureRecoveryTable
=== NAME  
=== RUN   TestV2_WorkflowPatternTable
=== PAUSE TestV2_WorkflowPatternTable
=== NAME  
=== RUN   TestV2_WorkflowStepTable
=== PAUSE TestV2_WorkflowStepTable
=== NAME  
=== RUN   TestV2_TaskCandidateTable
=== PAUSE TestV2_TaskCandidateTable
=== NAME  
=== RUN   TestV2_SuggestionCacheTable
=== PAUSE TestV2_SuggestionCacheTable
=== NAME  
=== RUN   TestV2_SuggestionFeedbackTable
=== PAUSE TestV2_SuggestionFeedbackTable
=== NAME  
=== RUN   TestV2_SessionAliasTable
=== PAUSE TestV2_SessionAliasTable
=== NAME  
=== RUN   TestV2_DismissalPatternTable
=== PAUSE TestV2_DismissalPatternTable
=== NAME  
=== RUN   TestV2_RankWeightProfileTable
=== PAUSE TestV2_RankWeightProfileTable
=== NAME  
=== RUN   TestV2_FTS5_InsertTrigger
=== PAUSE TestV2_FTS5_InsertTrigger
=== NAME  
=== RUN   TestV2_FTS5_EphemeralNotIndexed
=== PAUSE TestV2_FTS5_EphemeralNotIndexed
=== NAME  
=== RUN   TestV2_FTS5_DeleteTrigger
=== PAUSE TestV2_FTS5_DeleteTrigger
=== NAME  
=== RUN   TestV2_SeparateFromV1
=== PAUSE TestV2_SeparateFromV1
=== NAME  
=== RUN   TestV2_SchemaCountIs23
=== PAUSE TestV2_SchemaCountIs23
=== NAME  
=== RUN   TestV2_WALModeEnabled
=== PAUSE TestV2_WALModeEnabled
=== NAME  
=== RUN   TestV2_DefaultDBPath
=== PAUSE TestV2_DefaultDBPath
=== NAME  
=== RUN   TestV1_DefaultDBPath
=== PAUSE TestV1_DefaultDBPath
=== NAME  
=== RUN   TestIsCorruptionError_NilError
=== PAUSE TestIsCorruptionError_NilError
=== NAME  
=== RUN   TestIsCorruptionError_MalformedImage
=== PAUSE TestIsCorruptionError_MalformedImage
=== NAME  
=== RUN   TestIsCorruptionError_NotADatabase
=== PAUSE TestIsCorruptionError_NotADatabase
=== NAME  
=== RUN   TestIsCorruptionError_SQLiteCorrupt
=== PAUSE TestIsCorruptionError_SQLiteCorrupt
=== NAME  
=== RUN   TestIsCorruptionError_SQLiteNotADB
=== PAUSE TestIsCorruptionError_SQLiteNotADB
=== NAME  
=== RUN   TestIsCorruptionError_EncryptedDB
=== PAUSE TestIsCorruptionError_EncryptedDB
=== NAME  
=== RUN   TestIsCorruptionError_NormalError
=== PAUSE TestIsCorruptionError_NormalError
=== NAME  
=== RUN   TestIsCorruptionError_CaseInsensitive
=== PAUSE TestIsCorruptionError_CaseInsensitive
=== NAME  
=== RUN   TestIsPermissionError_EACCES
=== PAUSE TestIsPermissionError_EACCES
=== NAME  
=== RUN   TestIsPermissionError_NormalError
=== PAUSE TestIsPermissionError_NormalError
=== NAME  
=== RUN   TestIsPermissionError_NilError
=== PAUSE TestIsPermissionError_NilError
=== NAME  
=== RUN   TestIsDiskFullError_NoSpace
=== PAUSE TestIsDiskFullError_NoSpace
=== NAME  
=== RUN   TestIsDiskFullError_NilError
=== PAUSE TestIsDiskFullError_NilError
=== NAME  
=== RUN   TestIsDiskFullError_NormalError
=== PAUSE TestIsDiskFullError_NormalError
=== NAME  
=== RUN   TestRotateCorruptDB_AllFiles
=== PAUSE TestRotateCorruptDB_AllFiles
=== NAME  
=== RUN   TestRotateCorruptDB_OnlyMainFile
=== PAUSE TestRotateCorruptDB_OnlyMainFile
=== NAME  
=== RUN   TestRotateCorruptDB_NoFiles
=== PAUSE TestRotateCorruptDB_NoFiles
=== NAME  
=== RUN   TestRunIntegrityCheck_HealthyDB
=== PAUSE TestRunIntegrityCheck_HealthyDB
=== NAME  
=== RUN   TestRunIntegrityCheck_CorruptDB
=== PAUSE TestRunIntegrityCheck_CorruptDB
=== NAME  
=== RUN   TestCorruptionHistory_LoadEmpty
=== PAUSE TestCorruptionHistory_LoadEmpty
=== NAME  
=== RUN   TestCorruptionHistory_RecordAndLoad
=== PAUSE TestCorruptionHistory_RecordAndLoad
=== NAME  
=== RUN   TestCorruptionHistory_MultipleEvents
=== PAUSE TestCorruptionHistory_MultipleEvents
=== NAME  
=== RUN   TestCorruptionHistory_InvalidJSON
=== PAUSE TestCorruptionHistory_InvalidJSON
=== NAME  
=== RUN   TestCorruptionHistoryPath
=== PAUSE TestCorruptionHistoryPath
=== NAME  
=== RUN   TestCorruptionHistoryPath_Public
=== PAUSE TestCorruptionHistoryPath_Public
=== NAME  
=== RUN   TestRecoverAndReopen_SuccessfulRecovery
=== PAUSE TestRecoverAndReopen_SuccessfulRecovery
=== NAME  
=== RUN   TestOpen_WithRecovery_CorruptDB
=== PAUSE TestOpen_WithRecovery_CorruptDB
=== NAME  
=== RUN   TestOpen_WithRecovery_IntegrityCheck
=== PAUSE TestOpen_WithRecovery_IntegrityCheck
=== NAME  
=== RUN   TestOpen_WithoutRecovery_CorruptDB
=== PAUSE TestOpen_WithoutRecovery_CorruptDB
=== NAME  
=== RUN   TestOpen_V1DB_NoRecovery
=== PAUSE TestOpen_V1DB_NoRecovery
=== NAME  
=== RUN   TestOpen_WithRecovery_FreshDB
=== PAUSE TestOpen_WithRecovery_FreshDB
=== NAME  
=== RUN   TestOpen_WithRecovery_RecoveredDBIsFunctional
=== PAUSE TestOpen_WithRecovery_RecoveredDBIsFunctional
=== NAME  
=== RUN   TestOpen_WithRecovery_WALAndSHMRotated
=== PAUSE TestOpen_WithRecovery_WALAndSHMRotated
=== NAME  
=== RUN   TestOpen_WithRecovery_MultipleCycles
=== PAUSE TestOpen_WithRecovery_MultipleCycles
=== NAME  
=== RUN   TestErrorClassification_CorruptionNotPermission
=== PAUSE TestErrorClassification_CorruptionNotPermission
=== NAME  
=== RUN   TestErrorClassification_PermissionNotCorruption
=== PAUSE TestErrorClassification_PermissionNotCorruption
=== NAME  
=== RUN   TestErrorClassification_DiskFullNotCorruption
=== PAUSE TestErrorClassification_DiskFullNotCorruption
=== NAME  
=== RUN   TestCorruptionEvent_JSONRoundTrip
=== PAUSE TestCorruptionEvent_JSONRoundTrip
=== NAME  
=== RUN   TestOpen_WithRecovery_UsesProvidedLogger
=== PAUSE TestOpen_WithRecovery_UsesProvidedLogger
=== NAME  
=== CONT  TestOpen_CreatesDirectory
=== CONT  TestV2_FTS5_InsertTrigger
=== CONT  TestRunIntegrityCheck_CorruptDB
=== CONT  TestCorruptionEvent_JSONRoundTrip
=== CONT  TestOpen_WithRecovery_UsesProvidedLogger
=== CONT  TestErrorClassification_DiskFullNotCorruption
--- PASS: TestErrorClassification_DiskFullNotCorruption (0.00s)
=== CONT  TestErrorClassification_CorruptionNotPermission
--- PASS: TestErrorClassification_CorruptionNotPermission (0.00s)
=== CONT  TestErrorClassification_PermissionNotCorruption
--- PASS: TestErrorClassification_PermissionNotCorruption (0.00s)
=== CONT  TestOpen_WithRecovery_WALAndSHMRotated
=== CONT  TestOpen_WithRecovery_MultipleCycles
--- PASS: TestCorruptionEvent_JSONRoundTrip (0.00s)
=== CONT  TestRotateCorruptDB_AllFiles
=== CONT  TestOpen_WithRecovery_FreshDB
=== CONT  TestIsCorruptionError_SQLiteNotADB
--- PASS: TestIsCorruptionError_SQLiteNotADB (0.00s)
=== CONT  TestOpen_WithoutRecovery_CorruptDB
=== CONT  TestOpen_WithRecovery_RecoveredDBIsFunctional
--- PASS: TestRotateCorruptDB_AllFiles (0.00s)
=== CONT  TestIsPermissionError_NilError
--- PASS: TestIsPermissionError_NilError (0.00s)
=== CONT  TestCorruptionHistory_InvalidJSON
--- PASS: TestCorruptionHistory_InvalidJSON (0.00s)
=== CONT  TestOpen_WithRecovery_IntegrityCheck
2026/02/20 09:29:58 ERROR database corruption detected; rotated and reinitializing path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_MultipleCycles1141999323/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_MultipleCycles1141999323/001/suggestions_v2.db.corrupt.1771576198 reason="failed to connect to database: file is not a database (26)" original_size_bytes=7
--- PASS: TestRunIntegrityCheck_CorruptDB (0.01s)
=== CONT  TestIsDiskFullError_NoSpace
2026/02/20 09:29:58 ERROR database corruption detected; rotated and reinitializing path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_RecoveredDBIsFunctional974548775/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_RecoveredDBIsFunctional974548775/001/suggestions_v2.db.corrupt.1771576198 reason="failed to connect to database: file is not a database (26)" original_size_bytes=21
=== CONT  TestCorruptionHistory_MultipleEvents
--- PASS: TestIsDiskFullError_NoSpace (0.00s)
=== CONT  TestIsCorruptionError_SQLiteCorrupt
--- PASS: TestOpen_WithoutRecovery_CorruptDB (0.01s)
--- PASS: TestIsCorruptionError_SQLiteCorrupt (0.00s)
=== CONT  TestIsCorruptionError_CaseInsensitive
--- PASS: TestIsCorruptionError_CaseInsensitive (0.00s)
=== CONT  TestCorruptionHistory_LoadEmpty
--- PASS: TestCorruptionHistory_LoadEmpty (0.00s)
=== CONT  TestIsCorruptionError_NormalError
=== CONT  TestCorruptionHistory_RecordAndLoad
--- PASS: TestIsCorruptionError_NormalError (0.00s)
2026/02/20 09:29:58 ERROR database corruption detected; rotated and reinitializing path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_WALAndSHMRotated2925509050/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_WALAndSHMRotated2925509050/001/suggestions_v2.db.corrupt.1771576198 reason="failed to connect to database: file is not a database (26)" original_size_bytes=7
=== CONT  TestIsCorruptionError_EncryptedDB
--- PASS: TestIsCorruptionError_EncryptedDB (0.00s)
=== CONT  TestRunIntegrityCheck_HealthyDB
--- PASS: TestCorruptionHistory_RecordAndLoad (0.00s)
=== CONT  TestV2_DefaultDBPath
--- PASS: TestV2_DefaultDBPath (0.00s)
=== CONT  TestIsCorruptionError_MalformedImage
--- PASS: TestCorruptionHistory_MultipleEvents (0.00s)
=== CONT  TestIsPermissionError_EACCES
--- PASS: TestIsCorruptionError_MalformedImage (0.00s)
--- PASS: TestIsPermissionError_EACCES (0.00s)
=== CONT  TestV2_SchemaCountIs23
=== CONT  TestIsDiskFullError_NormalError
--- PASS: TestOpen_CreatesDirectory (0.07s)
--- PASS: TestIsDiskFullError_NormalError (0.00s)
=== CONT  TestV2Open_Idempotent
--- PASS: TestOpen_WithRecovery_WALAndSHMRotated (0.19s)
=== CONT  TestOpen_WithRecovery_CorruptDB
=== NAME  TestV2_SchemaCountIs23
    db_test.go:1668: Found 27 user tables in database
2026/02/20 09:29:58 ERROR database corruption detected; rotated and reinitializing path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_CorruptDB3375294293/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_CorruptDB3375294293/001/suggestions_v2.db.corrupt.1771576198 reason="failed to connect to database: file is not a database (26)" original_size_bytes=79
=== CONT  TestV2_RankWeightProfileTable
--- PASS: TestOpen_WithRecovery_RecoveredDBIsFunctional (0.20s)
--- PASS: TestOpen_WithRecovery_UsesProvidedLogger (0.21s)
=== CONT  TestV2_ProjectTypeTransitionTable
--- PASS: TestV2_FTS5_InsertTrigger (0.21s)
=== CONT  TestV2_FailureRecoveryTable
=== CONT  TestV2_SuggestionFeedbackTable
--- PASS: TestV2_SchemaCountIs23 (0.21s)
--- PASS: TestOpen_WithRecovery_FreshDB (0.22s)
=== CONT  TestV2_SlotStatTable
--- PASS: TestRunIntegrityCheck_HealthyDB (0.22s)
=== CONT  TestV2_SuggestionCacheTable
2026/02/20 09:29:58 ERROR database corruption detected; rotated and reinitializing path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_MultipleCycles1141999323/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_MultipleCycles1141999323/001/suggestions_v2.db.corrupt.1771576198 reason="failed to connect to database: file is not a database (26)" original_size_bytes=7
--- PASS: TestOpen_WithRecovery_IntegrityCheck (0.30s)
=== CONT  TestV2_ProjectTypeStatTable
--- PASS: TestV2_RankWeightProfileTable (0.19s)
=== CONT  TestV2_TaskCandidateTable
--- PASS: TestV2_FailureRecoveryTable (0.19s)
=== CONT  TestV2_TransitionStatTable
--- PASS: TestV2_ProjectTypeTransitionTable (0.20s)
=== CONT  TestV2_WorkflowStepTable
--- PASS: TestV2Open_Idempotent (0.35s)
=== CONT  TestV2_CommandEventTable
--- PASS: TestV2_SuggestionFeedbackTable (0.21s)
=== CONT  TestV2_WorkflowPatternTable
--- PASS: TestOpen_WithRecovery_CorruptDB (0.25s)
=== CONT  TestV2_SessionTable
--- PASS: TestV2_SlotStatTable (0.22s)
=== CONT  TestV2_PipelinePatternTable
--- PASS: TestV2_SuggestionCacheTable (0.23s)
=== CONT  TestV2Open_RefuseNewerVersion
2026/02/20 09:29:59 ERROR database corruption detected; rotated and reinitializing path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_MultipleCycles1141999323/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestOpen_WithRecovery_MultipleCycles1141999323/001/suggestions_v2.db.corrupt.1771576199 reason="failed to connect to database: file is not a database (26)" original_size_bytes=7
--- PASS: TestV2_ProjectTypeStatTable (0.22s)
=== CONT  TestV2_PipelineTransitionTable
--- PASS: TestV2_TaskCandidateTable (0.22s)
=== CONT  TestV2_PipelineEventTable
=== CONT  TestOpen_ReadOnly
--- PASS: TestV2_TransitionStatTable (0.22s)
=== CONT  TestV2Open_ValidateAll23Tables
--- PASS: TestV2_WorkflowPatternTable (0.19s)
=== CONT  TestDB_Validate
--- PASS: TestV2_WorkflowStepTable (0.22s)
--- PASS: TestV2_SessionTable (0.19s)
=== CONT  TestV2_CommandTemplateTable
--- PASS: TestV2_PipelinePatternTable (0.19s)
=== CONT  TestSchemaValidity_CommandEventTable
=== CONT  TestV2Open_CreatesDatabase
--- PASS: TestV2_CommandEventTable (0.21s)
--- PASS: TestV2Open_RefuseNewerVersion (0.23s)
=== CONT  TestSchemaValidity_ProjectTaskTable
=== CONT  TestSchemaValidity_ForeignKeyEnforced
--- PASS: TestOpen_ReadOnly (0.08s)
--- PASS: TestSchemaValidity_CommandEventTable (0.08s)
=== CONT  TestSchemaValidity_SlotValueTable
--- PASS: TestDB_Validate (0.08s)
=== CONT  TestSchemaValidity_TransitionTable
--- PASS: TestOpen_WithRecovery_MultipleCycles (0.72s)
=== CONT  TestSchemaValidity_CommandScoreTable
--- PASS: TestV2_PipelineTransitionTable (0.20s)
=== CONT  TestSchemaValidity_SessionTable
--- PASS: TestSchemaValidity_ProjectTaskTable (0.07s)
=== CONT  TestDB_PrepareStatement
--- PASS: TestSchemaValidity_ForeignKeyEnforced (0.07s)
=== CONT  TestDB_ConcurrentReads
--- PASS: TestSchemaValidity_SlotValueTable (0.07s)
=== CONT  TestOpen_ForeignKeysEnabled
--- PASS: TestSchemaValidity_SessionTable (0.07s)
=== CONT  TestOpen_RunsMigrations
--- PASS: TestSchemaValidity_TransitionTable (0.08s)
=== CONT  TestDB_SchemaVersion
--- PASS: TestSchemaValidity_CommandScoreTable (0.08s)
=== CONT  TestOpen_CreatesDatabase
=== CONT  TestOpen_WALModeEnabled
--- PASS: TestV2_PipelineEventTable (0.19s)
=== CONT  TestIsDiskFullError_NilError
--- PASS: TestDB_PrepareStatement (0.07s)
=== CONT  TestV2_CommandStatTable
--- PASS: TestIsDiskFullError_NilError (0.00s)
--- PASS: TestV2_CommandTemplateTable (0.19s)
=== CONT  TestV2_SessionAliasTable
--- PASS: TestV2Open_ValidateAll23Tables (0.21s)
=== CONT  TestV2_SlotCorrelationTable
--- PASS: TestV2Open_CreatesDatabase (0.20s)
=== CONT  TestRecoverAndReopen_SuccessfulRecovery
=== CONT  TestIsPermissionError_NormalError
--- PASS: TestDB_ConcurrentReads (0.08s)
--- PASS: TestIsPermissionError_NormalError (0.00s)
=== CONT  TestCorruptionHistoryPath
=== CONT  TestIsCorruptionError_NotADatabase
--- PASS: TestCorruptionHistoryPath (0.00s)
--- PASS: TestIsCorruptionError_NotADatabase (0.00s)
=== CONT  TestRotateCorruptDB_NoFiles
--- PASS: TestRotateCorruptDB_NoFiles (0.00s)
=== CONT  TestOpen_V1DB_NoRecovery
=== CONT  TestRotateCorruptDB_OnlyMainFile
--- PASS: TestOpen_V1DB_NoRecovery (0.01s)
--- PASS: TestRotateCorruptDB_OnlyMainFile (0.00s)
=== CONT  TestIsCorruptionError_NilError
--- PASS: TestIsCorruptionError_NilError (0.00s)
=== CONT  TestV2_SeparateFromV1
--- PASS: TestOpen_ForeignKeysEnabled (0.07s)
=== CONT  TestV2_FTS5_EphemeralNotIndexed
--- PASS: TestDB_SchemaVersion (0.07s)
=== CONT  TestV2_WALModeEnabled
--- PASS: TestOpen_CreatesDatabase (0.07s)
=== CONT  TestV1_DefaultDBPath
--- PASS: TestV1_DefaultDBPath (0.00s)
=== CONT  TestV2_FTS5_DeleteTrigger
--- PASS: TestOpen_RunsMigrations (0.08s)
=== CONT  TestV2_DismissalPatternTable
--- PASS: TestOpen_WALModeEnabled (0.07s)
=== CONT  TestCorruptionHistoryPath_Public
--- PASS: TestCorruptionHistoryPath_Public (0.00s)
=== CONT  TestV2Open_SchemaVersion
--- PASS: TestV2_CommandStatTable (0.19s)
=== CONT  TestMigrations_RefuseNewerVersion
--- PASS: TestV2_SessionAliasTable (0.20s)
=== CONT  TestMigrations_Idempotent
=== CONT  TestDB_Close
--- PASS: TestV2_SlotCorrelationTable (0.20s)
time=2026-02-20T09:29:59.634+01:00 level=ERROR msg="database corruption detected; rotated and reinitializing" path=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestRecoverAndReopen_SuccessfulRecovery2658852199/001/suggestions_v2.db backup=/var/folders/cw/7cjc3nt55wl119pn0t4z7rmc0000gn/T/TestRecoverAndReopen_SuccessfulRecovery2658852199/001/suggestions_v2.db.corrupt.1771576199 reason="test corruption" original_size_bytes=258048
--- PASS: TestV2_WALModeEnabled (0.20s)
--- PASS: TestV2_FTS5_EphemeralNotIndexed (0.21s)
--- PASS: TestV2_DismissalPatternTable (0.20s)
--- PASS: TestV2Open_SchemaVersion (0.19s)
--- PASS: TestV2_FTS5_DeleteTrigger (0.21s)
--- PASS: TestDB_Close (0.06s)
--- PASS: TestMigrations_RefuseNewerVersion (0.07s)
--- PASS: TestMigrations_Idempotent (0.08s)
--- PASS: TestV2_SeparateFromV1 (0.26s)
--- PASS: TestRecoverAndReopen_SuccessfulRecovery (0.31s)
PASS
ok  	github.com/runger/clai/internal/suggestions/db	4.129s
