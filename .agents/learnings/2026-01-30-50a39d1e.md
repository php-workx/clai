# Learnings from Session 50a39d1e

**Date**: 2026-01-30
**Session ID**: 50a39d1e-1092-4dc8-ac9a-2563ba664f61

---

# Learning: ZLE Context Errors Require Explicit Widget Checks

**ID**: L1
**Category**: debugging
**Confidence**: high

## What We Learned

ZLE (Zsh Line Editor) functions that call `zle reset-prompt` or other ZLE commands must verify they're running in ZLE context first. The fix is to guard with `[[ -n "$WIDGET" ]] && zle reset-prompt` since `$WIDGET` is only set when inside a ZLE widget.

## Why It Matters

This prevents "widgets can only be called when ZLE is active" errors that break shell integration when functions are called from non-ZLE contexts (e.g., precmd hooks, sourcing).

## Source

Session: 50a39d1e-1092-4dc8-ac9a-2563ba664f61

---

# Learning: Static Shell Tests Cannot Catch Interactive Bugs

**ID**: L2
**Category**: testing
**Confidence**: high

## What We Learned

Syntax validation (`zsh -n`, `bash -n`) and string-based function detection cannot catch interactive shell bugs like: RPS1 not updating (missing `zle reset-prompt`), ZLE widget context errors, key binding failures, or visual display issues. These require spawning real interactive sessions and validating terminal output.

## Why It Matters

Led to implementing expect-based interactive tests using `go-expect` to catch these classes of bugs that static tests miss.

## Source

Session: 50a39d1e-1092-4dc8-ac9a-2563ba664f61

---

# Learning: Use errors.Is() for Context Cancellation Checks

**ID**: L3
**Category**: debugging
**Confidence**: high

## What We Learned

Checking `if err != context.Canceled` is incorrect in Go. Must use `if !errors.Is(err, context.Canceled)` because context errors may be wrapped. This requires importing `"errors"`.

## Why It Matters

Incorrect error comparisons cause silent failures where cancellation propagates incorrectly, making Ctrl+C handling unreliable.

## Source

Session: 50a39d1e-1092-4dc8-ac9a-2563ba664f61
