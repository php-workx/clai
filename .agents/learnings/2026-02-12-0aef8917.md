# Learning: Use Relative Thresholds for Performance Tests in CI

**ID**: L1
**Category**: testing
**Confidence**: high

## What We Learned

Performance tests using absolute time thresholds (e.g., "must complete in < 300ms") are fragile across different environments (CI runners, containers, developer machines). Using relative thresholds (e.g., "overhead must be < 50% of baseline") makes tests portable and reliable while still catching regressions.

## Why It Matters

Prevents flaky CI failures on slower runners and eliminates the need to skip performance tests inside containers, while still catching real performance regressions.

## Source

Session: 0aef8917-f657-4a29-9c72-d9e223525c7b

---

# Learning: Container Detection Guards Are Insufficient for Performance Tests

**ID**: L2
**Category**: testing
**Confidence**: medium

## What We Learned

The existing `isRunningInContainer()` helper was only used to skip one test (`TestPerformance_InitCommandFast`), while other performance tests with absolute thresholds remained unguarded. This inconsistency means some performance tests still fail in containers. The better fix is to make all performance tests container-safe via relative thresholds rather than adding more skip guards.

## Why It Matters

Systematic approaches (relative thresholds everywhere) are more maintainable than point fixes (skip guards on individual tests).

## Source

Session: 0aef8917-f657-4a29-9c72-d9e223525c7b
